<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
                   assembly="Zbang.Zbox.ViewModel"
                   namespace="Zbang.Zbox.ViewModel.DTOs">

  <resultset name="BoxDto">
    <return-scalar column="Id" type="long"/>
    <return-scalar column="BoxName" type="string"/>
    <return-scalar column="BoxPicture" type="string"/>
    <!--<return-scalar column="UpdateTime" type="DateTime"/>-->
    <return-scalar column="UserType" type="Zbang.Zbox.Infrastructure.Enums.UserRelationshipType,Zbang.Zbox.Infrastructure"/>
    <return-scalar column="ItemCount" type="int"/>
   
    <return-scalar column="MembersCount" type="int"/>
    <return-scalar column="CommentCount" type="int"/>
    <return-scalar column="CourseCode" type="string"/>
    <return-scalar column="ProfessorName" type="string"/>
    <return-scalar column="BoxType" type="Zbang.Zbox.Infrastructure.Enums.BoxType,Zbang.Zbox.Infrastructure"/>
    <return-scalar column="Url" type="string"/>
  </resultset>
  <resultset name="DtoCount">
    <return-scalar column="Count" type="Int32"/>
  </resultset>
 
  
  <sql-query name="ZboxGetAcademicBoxesByNode" resultset-ref="BoxDto" read-only="1">
    <![CDATA[
    select b.boxid as Id,
    b.BoxName as BoxName,
    b.CourseCode as CourseCode,
    (select ub2.UserType from zbox.UserBoxRel ub2 where ub2.userid = :UserId and ub2.boxid = b.BoxId) as UserType ,
    b.itemcount as ItemCount,
    b.MembersCount as MembersCount,
    b.commentcount as CommentCount,
    b.pictureurl as BoxPicture, 
    b.ProfessorName as ProfessorName,
    b.Discriminator as boxType,
    b.Url as Url
    from zbox.box b 
    where b.IsDeleted = 0  and b.discriminator = 2
    and  b.department = :ParentNode
    ORDER BY  
          BoxName asc
    ]]>
  </sql-query>
</hibernate-mapping>
