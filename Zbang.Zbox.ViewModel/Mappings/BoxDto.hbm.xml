<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
                   assembly="Zbang.Zbox.ViewModel"
                   namespace="Zbang.Zbox.ViewModel.DTOs">


  <resultset name="Box">
    <return-scalar type="string" column="Image"/>
    <return-scalar type="string" column="Name"/>
    <return-scalar type="string" column="OwnerName"/>
    <return-scalar type="string" column="UniCountry"/>
    <return-scalar type="long" column="OwnerId"/>
    <return-scalar type="string" column="CourseId"/>
    <return-scalar type="string" column="ProfessorName"/>
    <return-scalar type="Zbang.Zbox.Infrastructure.Enums.BoxType,Zbang.Zbox.Infrastructure" column="BoxType"/>
    <return-scalar type="long" column="Members"/>
    <return-scalar type="long" column="Items"/>
    <return-scalar type="long" column="Comments"/>
    <return-scalar type="Zbang.Zbox.Infrastructure.Enums.BoxPrivacySettings,Zbang.Zbox.Infrastructure" column="PrivacySetting"/>
  </resultset>

  <resultset name="BoxMembers">
    <return-scalar type="Zbang.Zbox.Infrastructure.Enums.UserRelationshipType,Zbang.Zbox.Infrastructure" column="UserStatus"/>
    <return-scalar type="string" column="Image"/>
    <return-scalar type="string" column="Name"/>
    <return-scalar type="string" column="Url"/>
    
    <return-scalar type="long" column="Id"/>
  </resultset>
  <resultset name="boxMeta" >
    <return-scalar type="long" column="Id"/>
    <return-scalar type="string" column="Image"/>
    <return-scalar type="string" column="Name"/>
    <return-scalar type="string" column="Url"/>
  </resultset>




  <query name="GetBoxSettingsDtoById">
    <![CDATA[
    select b.Id as Id, b.Name as Name, b.PrivacySettings.PrivacySetting as PrivacySetting,
    ub.NotificationSettings as NotificationSetting, ub.UserRelationshipType as UserType
    from Box b join b.UserBoxRelationship ub
    where b.Id =:Id
    and b.IsDeleted = 0  
    and ub.User.Id =:Userid
    ]]>
  </query>


  <!--<sql-query name="GetBoxMetaForInvite" read-only="1" resultset-ref="boxMeta">
    <![CDATA[
   select b.boxId as Id, b.boxName as Name, b.pictureurl as Image, b.Url as Url
    from zbox.Box b 
    where b.boxId = :BoxId
    and b.IsDeleted = 0  
    ]]>
  </sql-query>-->

  <!--Box Page-->
  <sql-query name="GetBox" read-only="1" resultset-ref="Box">
    <![CDATA[
    select b.BoxName as Name,
    b.PrivacySetting as PrivacySetting,
    b.CourseCode as CourseId,
    b.ProfessorName as ProfessorName, 
    case b.Discriminator when 2 then u.universityname
								                    else u.UserName
								                    end as OwnerName,
    u.country as UniCountry,
    u.userid as OwnerId,
    b.Discriminator as BoxType,
    b.MembersCount as Members,
    b.ItemCount as Items,
    b.CommentCount as Comments,
    b.pictureUrl as Image
    from zbox.Box b join zbox.Users u on b.OwnerId = u.UserId
    where  b.boxId = :BoxId
    and b.IsDeleted = 0  
    ]]>
  </sql-query>


  <!--Notification screen account settings-->
  <!--<query name="GetUserBoxesNotification" read-only="1">
    <![CDATA[
    select b.Id as Id, b.Name as Name, b.Owner.Name as Owner, ub.NotificationSettings as Notifications, b.class as boxType, b.Url as url
    from Box b join b.UserBoxRelationship ub
    where b.IsDeleted = 0
    and ub.UserId = :UserId
    ]]>
  </query>-->



  <!--box page - notification pop up-->
  <!--<query name="GetBoxNotificationByUser" read-only="1">
    <![CDATA[
    select ub.NotificationSettings as Notifications from UserBoxRel ub
    where ub.UserId = :UserId
    and ub.BoxId = :BoxId
    ]]>
  </query>-->


  <!--box page - used to get all the members of the box in pop up-->
  <sql-query name="GetBoxMembers" read-only="1" resultset-ref="BoxMembers">
    <![CDATA[
    select u.UserId as Id , u.UserName as Name,u.UserImageLarge as Image , ub.UserType as userStatus, u.url as Url
    from zbox.UserBoxRel ub 
	    join zbox.users u on ub.UserId =  u.UserId
    where ub.BoxId=:BoxId
    ]]>
  </sql-query>
</hibernate-mapping>