alter table sb.[transaction]
add [TransactionType] nvarchar(255)

update top (1000) sb.[Transaction]
set [TransactionType] = 'CashOut'
where Action = 'CashOut'
and [TransactionType] is null

update top (1000) sb.[Transaction]
set [TransactionType] = 'Award'
where Action in ( 'None','FirstCourse','Awarded','SignUp')
and Type = 'Earned'
and [TransactionType] is null

update top (1000) sb.[Transaction]
set [TransactionType] = 'Refer'
where Action in ( 'ReferringUser')
and Type = 'Earned'
and [TransactionType] is null

update top (1000) sb.[Transaction]
set [TransactionType] = 'Question'
where (QuestionId is not null or AnswerId is not null)
and [TransactionType] is null


update top (1000) sb.[Transaction]
set [TransactionType] = 'Question'
where  Action in  ('Question','DeleteQuestion','AnswerCorrect')
and [TransactionType] is null

update top (1000) sb.[Transaction]
set [TransactionType] = 'Commission'
where   [TransactionType] = 'Commision'





update top (1000) sb.[Transaction]
set [TransactionType] = 'Document'
where (DocumentId is not null )
and [TransactionType] is null


drop table sb.EmailBlock
drop table sb.email
alter table sb.[user] drop constraint  User_Language
drop table sb.Language
drop table sb.SystemEvent

--need to upload to cosmos the emails
--need to add cosmos db to azure function
--need to upload azure function

 alter table sb.[transaction ]
 add PayPalTransactionId nvarchar(255);
 CREATE UNIQUE NONCLUSTERED INDEX idx_PayPalTransactionId_notnull
               ON sb.[transaction ](PayPalTransactionId)
               WHERE PayPalTransactionId IS NOT NULL;

--need to update question search index.
--need to update document search index.

Alter table sb.question
Alter column Subject_id int null;

Delete question version file
Delete document version file


UPDATE
    d
SET
   Type = it.ItemTabName
FROM
    sb.Document AS d
    join zbox.item i on d.OldId = i.ItemId
	join zbox.ItemTab it on i.ItemTabId = it.ItemTabId

WHERE
	Type = 'None'