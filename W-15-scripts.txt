CREATE TABLE [sb].[Language](
	[Name] [nvarchar](100) NOT NULL
PRIMARY KEY CLUSTERED 
(
	[Name] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]


insert into sb.[Language] values ('en'),('he')
CREATE VIEW [dbo].[vwLeaderBoard] WITH SCHEMABINDING 
    AS

    select U.Id, U.Name, Score, Un.Name as University
    from sb.[user] U
    join sb.University UN
        on U.UniversityId2 = UN.Id
    where LockoutEnd is null
    
GO

CREATE UNIQUE CLUSTERED INDEX IX_vwLeadewrBoard
       ON [dbo].[vwLeadewrBoard] (Id, Score);


Alter table sb.[user]
add  [Language] nvarchar(100)


ALTER TABLE [sb].[User]  WITH CHECK ADD  CONSTRAINT User_Language FOREIGN KEY([Language])
REFERENCES sb.[Language] ([Name])
GO

ALTER TABLE [sb].[User] CHECK CONSTRAINT User_Language
GO

--TODO need to check before running this update
--Select distinct culture  from sb.[user]
update sb.[user]
set Language = 'en'
where Culture in ('en','en-US','en-GB','ar-SA','ar-AE','ru-RU')

update sb.[user]
set Language = 'he'
where Culture in ('he','he-IL')


/****** Object:  Table [sb].[SystemEvent]    Script Date: 17/01/2019 10:09:06 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [sb].[SystemEvent](
	[Name] [nvarchar](100) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[Name] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO






/****** Object:  Table [sb].[Email]    Script Date: 20/01/2019 13:53:13 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [sb].[Email](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Subject] [nvarchar](255) NOT NULL,
	[SocialShare] [bit] NOT NULL,
	[Language] [nvarchar](100) NULL,
	[Event] [nvarchar](100) NULL,
PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO



/****** Object:  Table [sb].[EmailBlock]    Script Date: 20/01/2019 13:50:28 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [sb].[EmailBlock](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Title] [nvarchar](255) NULL,
	[Subtitle] [nvarchar](255) NULL,
	[Body] [nvarchar](1000) NULL,
	[Cta] [nvarchar](255) NULL,
	[OrderBlock] [int] NULL,
	[Email_id] [int] NULL,
PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO

ALTER TABLE [sb].[EmailBlock]  WITH CHECK ADD  CONSTRAINT [FK_47B2DBD] FOREIGN KEY([Email_id])
REFERENCES [sb].[Email] ([Id])
GO

ALTER TABLE [sb].[EmailBlock] CHECK CONSTRAINT [FK_47B2DBD]
GO





insert into sb.SystemEvent values('DocumentPurchased')


insert into sb.Email values(
'Awesome you just earned -Tokens- SBL',
1,
'en',
'DocumentPurchased')

insert into sb.emailblock values(
'Great job, you helped someone with your knowledge!',
'You earned -Tokens- SBL',
'A student from {CourseName} just purchased your document {DocumentName}.',
'Check your balance'
,1
,1
)


insert into sb.Email values(
N'מעולה - הרגע הרווחת - Tokens - SBL',
1,
'he',
'DocumentPurchased')


insert into sb.emailblock values(
N'שיחקת אותה - עזרת למישהו אחר עם הידע שלך',
N'הרווחת - Token - SBL',
N'סטודנט מ{Class Name} רכש את המסמך שלך {DocumentName}',
N'הארנק שלי '
,1
,2
)




