az servicebus topic create --name communication --namespace-name spitball-prod --resource-group zbox
az servicebus topic subscription create --resource-group zbox --namespace-name spitball-prod --topic-name communication --name sms
az servicebus topic subscription rule create --resource-group zbox --namespace-name spitball-prod --topic-name communication --subscription-name sms --name smsRule --filter-sql-expression "sys.Label= 'sms'"
az servicebus topic subscription create --resource-group zbox --namespace-name spitball-prod --topic-name communication --name call
az servicebus topic subscription rule create --resource-group zbox --namespace-name spitball-prod --topic-name communication --subscription-name call --name phoneRule --filter-sql-expression "sys.Label= 'phone'"

need to upload azure function v2.

need to run in case we want to change the Score system to transactions count
first run the first update statement until all records have been updated and 
then run the second update for all tire1 users
begin tran
update top(10000) U
set Score = (select count(1) 
			from sb.[Transaction] 
			where TransactionType in ('Question', 'Document') 
				and Price > 0 
				and [Type] = 'Earned'
				and U.Id = [User_Id]
			)
from sb.[User] U 
where Score != (select count(1) 
			from sb.[Transaction] 
			where TransactionType in ('Question', 'Document') 
				and Price > 0 
				and [Type] = 'Earned'
				and U.Id = [User_Id]
			)


begin tran
update top(5000) U
set Score = Score + 2
from sb.[User] U 
where U.Country in ('US', 'CA', 'AU' , 'GB', 'IE', 'IL', 'NZ', 'MX', 'SE' , 'NO', 'DK', 'FI', 'NL', 'BE','LU','DE','CH','AT','ZA')
and Score != 2 + (select count(1) 
			from sb.[Transaction] 
			where TransactionType in ('Question', 'Document') 
				and Price > 0 
				and [Type] = 'Earned'
				and U.Id = [User_Id]
			)
commit
rollback