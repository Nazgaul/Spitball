alter table sb.[transaction]
add [TransactionType] nvarchar(255)

update top (1000) sb.[Transaction]
set [TransactionType] = 'CashOut'
where Action = 'CashOut'
and [TransactionType] is null

update top (1000) sb.[Transaction]
set [TransactionType] = 'Award'
where Action in ( 'None','FirstCourse','Awarded','SignUp')
and Type = 'Earned'
and [TransactionType] is null

update top (1000) sb.[Transaction]
set [TransactionType] = 'Refer'
where Action in ( 'ReferringUser')
and Type = 'Earned'
and [TransactionType] is null

update top (1000) sb.[Transaction]
set [TransactionType] = 'Question'
where (QuestionId is not null or AnswerId is not null)
and [TransactionType] is null


update top (1000) sb.[Transaction]
set [TransactionType] = 'Question'
where  Action in  ('Question','DeleteQuestion','AnswerCorrect')
and [TransactionType] is null

update top (1000) sb.[Transaction]
set [TransactionType] = 'Commission'
where   [TransactionType] = 'Commision'





update top (1000) sb.[Transaction]
set [TransactionType] = 'Document'
where (DocumentId is not null )
and [TransactionType] is null

 alter table sb.[transaction ]
 add PayPalTransactionId nvarchar(255);
 CREATE UNIQUE NONCLUSTERED INDEX idx_PayPalTransactionId_notnull
               ON sb.[transaction ](PayPalTransactionId)
               WHERE PayPalTransactionId IS NOT NULL;

alter table sb.[user] drop constraint  User_Language

Alter table sb.question
Alter column Subject_id int null;

	update sb.[user]
set Language = 'en'
where Culture in ('en','en-US','en-GB','ar-SA','ar-AE','ru-RU')
and Language is null

update sb.[user]
set Language = 'he'
where Culture in ('he','he-IL')
and Language is null

update sb.[User]
set Language = 'he'
where Country = 'IL'
and Language is null

update sb.[User]
set Language = 'en'
where Language is null


alter table sb.[User] add LockoutReason nvarchar(255)

--need to update question search index.
--need to update document search index.

--need to upload to cosmos the emails
--need to add cosmos db to azure function
--need to upload azure function

Delete question version file
Delete document version file


--done until here

drop table sb.EmailBlock
drop table sb.email
drop table sb.Language
drop table sb.SystemEvent

UPDATE
    d
SET
   Type = it.ItemTabName
FROM
    sb.Document AS d
    join zbox.item i on d.OldId = i.ItemId
	join zbox.ItemTab it on i.ItemTabId = it.ItemTabId

WHERE
	Type = 'None'



update Q
set CourseId = null
from sb.Question Q
where Q.CourseId not in (select [name] from sb.Course)



Not sure we need this after UserMap Table("[User]") should solve the issue
alter table sb.[Question] add constraint FK_2124E48A foreign key (FlaggedUserId) references sb.[User]
