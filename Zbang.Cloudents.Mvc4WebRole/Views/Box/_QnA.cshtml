@using Zbang.Cloudents.Mvc4WebRole.Views.Box.Resources
@using Zbang.Cloudents.Mvc4WebRole.Views.Shared.Resources

<aside class="QA rFloat" ng-if="info.state !== 0" ng-controller="QnACtrl">

    <form class="clearfix QForm" name="qnaQform" ng-submit="postQuestion(qnaQform.$valid)" ng-if="info.state > 1" novalidate>
        <div class="textareaWpr">
            <img ng-src="info.userImage" class="QAImg lFloat" alt="" width="32" height="32" />
            <textarea name="content" class="QTextarea" ng-placeholder="@IndexResources.OnYourMind" required ng-model="qFormData.content" ng-focus="showPostBtn('outer')"></textarea>
            <ul class="attachedList">
                <li class="attachedItem" ng-repeat="file in qFormData.files">
                    <span class="attachName elps">{{file.name}}</span>
                    <button class="removeAttach" ng-click="removeQuestionAttachment(file)"></button>
                </li>
            </ul>
        </div>
        <div class="rFloat">
            <button type="button" class="attachBtn" ng-click="addQuestionAttachment('outer')"></button>
            <button type="submit" class="askBtn" ng-disabled="!qnaQform.$valid" ng-show="info.postBtnVisible">@SharedResources.Post</button>
        </div>
    </form>
    <button type="button" ng-click="showAllQuestion()" ng-show="info.state > 1" class="back">@SharedResources.Back</button>

    <div class="QWpr" ng-show="info.state === 2">
        <div class="questions">
            <ul class="QList">
                <li class="QItem" ng-repeat="question in info.questions">
                    <div class="QTop clearfix " ng-click="showAllAnswers(question)" ng-class="{hasAttached: question.files.length}">
                        <span class="tag" ng-if="question.isNew">@SharedResources.New</span>
                        <div class="lFloat QTopLeft">
                            <img class="QAImg calloutTrgr" ng-src="question.userImage" alt="" width="32" height="32" />
                            <div class="attachBtn"></div>
                            <div class="numAttached">{{question.files.length}}</div>
                        </div>
                        <div class="userName boldFont elps"></div><span class="createTime" data-time="{{question.createTime}}">{{question.userName}}</span>
                        <div class="QContent" ng-bind-html="question.content"></div>
                    </div>
                    <ng-form name="qnaAform" ng-submit="postAnswer(question)" novalidate ng-if="!question.answers.length">
                        <div class="arrow upArrow"></div>
                        <img class="QAImg lFloat" ng-src="info.userImage" alt="" width="32" height="32" />
                        <div class="textareaWpr">
                            <textarea name="content" class="QTextarea" ng-placeholder="@SharedResources.WriteComment" ng-model="question.aFormData.content" ng-focus="showCommentBtn(question)"></textarea>
                            <<ul class="attachedList">
                                <li class="attachedItem" ng-repeat="file in aFormData.files">
                                    <span class="attachName elps">{{file.name}}</span>
                                    <button class="removeAttach" ng-click="removeAnswerAttachment(question,file)"></button>
                                </li>
                            </ul>
                        </div>
                        <div class="rFloat">
                            <button type="button" class="attachBtn" ng-click="addAnswerAttachment(question)"></button>
                            <button type="submit" class="askBtn" ng-disabled="!qnaAform.$valid" ng-show="question.aFormData.showComment">@SharedResources.Comment</button>
                        </div>
                    </ng-form>
                    <div class="QBottom clearfix">
                        <div class="arrow upArrow" ng-if="question.answers.length"></div>
                        <div class="answerBottom" ng-click="showAllAnswers(question)" ng-if="question.answers.length">
                            <button type="button" class="numAnswers">{{question.answerLength}}</button>
                            <button type="button">@IndexResources.AddComment</button>
                        </div>

                        <span ng-if="question.bestAnswer">
                            <img class="QAImg lFloat calloutTrgr" ng-src="question.bestAnswer" alt="" width="32" height="32" />
                            <div class="AUsername semiFont elps">{{question.bestAnswer.userName}}</div><span class="createTime" data-time="question.bestAnswer.createTime"></span>
                            <div class="AContent" ng-bind-html="question.bestAnswer.content"></div>
                            <ul class="qaAttach">
                                <li class="qaAttachItem" ng-repeat="file in question.bestAnswer.files">
                                    <a ng-href="{{file.itemUrl}}"><img ng-src="{{file.thumbnail}}" alt="" width="100" height="125" /></a>
                                    <div class="attachActions">
                                        <a class="attachFull" ng-href="{{file.itemUrl}}"></a>
                                        <button class="attachDelete" type="button" ng-if="file.isVisible"></button>
                                        <a class="attachDownload" ng-href={{file.download}}"></a>
                                    </div>
                                </li>
                            </ul>
                        </span>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <div class="AWpr">
        <div id="Answers" class="answers">
            <span ng-if="info.selectedQuestion" ng-show="info.state === 3">
                <div class="question">
                    <img class="QAImg lFloat calloutTrgr" ng-src="{{info.selectedQuestion.userImage}}" alt="" width="32" height="32" />
                    <div class="questionRhs">
                        <div class="userName boldFont elps">{{info.selectedQuestion.username}}</div><span class="createTime innerSection" data-time="{{info.selectedQuestion.createTime}}"></span>
                        <div class="QContent" ng-bind-html="info.selectedQuestion.content"></div>
                    </div>
                    <button type="button" class="deleteBtn" ng-click="deleteQuestion(question)" ng-if="canDelete(info.selectedQuestion)"></button>
                </div>
                <div class="lFloat" ng-class="{attachLeft : info.selectedQuestion.files.length}">
                    <div class="attachBtn"></div>
                    <div class="numAttached">info.selectedQuestion.files.length</div>
                </div>
                <ul class="qaAttach">
                    <li class="qaAttachItem" ng-repeat="file in info.selectedQuestion.files">
                        <a ng-href="{{file.itemUrl}}"><img ng-src="{{file.thumbnail}}" alt="" width="100" height="125" /></a>
                        <div class="attachActions">
                            <a data-title="@IndexResources.ShowAttachment" ng-href="{{file.itemUrl}}" class="attachFull"></a>
                            <button data-title="@IndexResources.RemoveAttachment" class="attachDelete" type="button" ng-if="file.isVisible></button>
                            <a data-title="@IndexResources.DownloadAttachment" class="attachDownload" target="_blank" ng-href={{file.download}}"></a>
                        </div>
                    </li>
                </ul>
                <ul class="AList">
                    <li class="AItem" ng-repeat="answer in info.selectedQuestion.answers" ng-class="{best : answer.isAnswer}">
                        @*Temporarily Removed vote btn... DO NOT DELETE!*@
                        @*<div class="bestAnswer splitHR"><span class="splitHRText">@IndexResources.BestAnswer</span></div>*@
                        <img class="QAImg lFloat calloutTrgr" ng-src="{{answer.userImage}}" alt="" width="32" height="32" />
                        <div class="userName boldFont elps">{{answer.userName}}</div><span class="createTime innerSection" data-time="{{answer.createTime}}"></span>
                        @*Temporarily Removed vote btn... DO NOT DELETE!*@
                        @*<button title="@IndexResources.Useful" class="voteBtn rFloat" type="button" data-bind="click:$root.rateAnswer"></button>
                            <span class="aScore rFloat" data-bind="text:rating"></span>*@
                        <button type="button" class="deleteBtn rFloat" ng-click="deleteAnswer(answer)" ng-if="canDelete(answer)"></button>
                        <div class="AContent" ng-bind-html="answer.content"></div>
                        @*Temporarily Removed vote btn... DO NOT DELETE!*@
                        @*<button title="@IndexResources.MarkCorrect" type="button" class="markAnswerBtn" data-bind="click: $root.markAnswer, visible: $parent.canMarkAsAnswer"></button>*@
                        <ul class="qaAttach">
                            <li class="qaAttachItem" ng-repeat="file in answer.files">
                                <a ng-href="{{file.itemUrl}}"><img ng-src="{{file.thumbnail}}" alt="" width="100" height="125" /></a>
                                <div class="attachActions">
                                    <a class="attachFull" ng-href={{file.itemUrl}}"></a>
                                    <button class="attachDelete" type="button" ng-if="file.isVisible"></button>
                                    <a class="attachDownload" target="_blank" ng-href="{{item.download}}"></a>
                                </div>
                            </li>
                        </ul>
                    </li>
                </ul>
                <div class="enterAnswer clearfix">
                    <ng-form class="clearfix" name="qnaAInnerForm" ng-submit="postAnswer(info.selectedQuestion)" novalidate>
                        <img class="QAImg lFloat" ng-src="{{info.userImage}}" alt="" width="32" height="32" />
                        <div class="textareaWpr">
                            <textarea name="content" required class="QTextarea" ng-placeholder="@SharedResources.WriteComment" ng-model="info.selectedQuestion.aFormData.content" ng-focus="showCommentBtn(info.selectedQuestion)"></textarea>
                            <ul class="attachedList">
                                <li class="attachedItem" ng-repeat="file in info.selectedQuestion.aFormData.files">
                                    <span class="attachName elps">{{file.name}}</span>
                                    <button class="removeAttach" ng-click="removeAnswerAttachment(info.selectedQuestion,file)"></button>
                                </li>
                            </ul>
                        </div>
                        <div class="rFloat">
                            <button type="button" class="attachBtn" ng-click="addAnswerAttachment(info.selectedQuestion)"></button>
                            <button type="submit" class="askBtn" ng-disabled="!qnaAInnerForm.$valid" ng-show="info.selectedQuestion.aFormData.showComment">@SharedResources.Comment</button>
                        </div>
                    </ng-form>
                </div>
            </span>
        </div>
    </div>

    <div class="QAContent">
        <div class="QEmpty" ng-if="info.state === 1">
            <div class="qaText1">@IndexResources.NotClear</div>
            <form class="clearfix QEmptyForm" name="qnaQInnerForm" ng-submit="postQuestion(qnaQInnerForm.$valid)" novalidate>
                <div class="textareaWpr">
                    <img ng-src="{{info.userImage}}" class="QAImg lFloat" alt="" width="32" height="32" />
                    <textarea name="content" class="QTextarea" ng-placeholder="@IndexResources.OnYourMind" required ng-model="qInnerFormData.content" ng-focus="showPostBtn('inner')"></textarea>
                    <ul class="attachedList">
                        <li class="attachedItem" ng-repeat="file in qFormData.files">
                            <span class="attachName elps">{{file.name}}</span>
                            <button class="removeAttach" ng-click="removeQuestionAttachment(file)"></button>
                        </li>
                    </ul>
                </div>
                <div class="rFloat">
                    <button type="button" class="attachBtn" ng-click="addQuestionAttachment('inner')"></button>
                    <button type="submit" class="askBtn" ng-disabled="!qnaQInnerForm.$valid" ng-show="info.postInnerBtnVisible">@SharedResources.Comment</button>
                </div>
            </form>
            <div class="qaText2">@IndexResources.NoQuestions</div>
        </div>
    </div>



</aside>
