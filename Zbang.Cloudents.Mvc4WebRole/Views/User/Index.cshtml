@using Zbang.Cloudents.Mvc4WebRole.Views.Shared.Resources
@using Zbang.Cloudents.Mvc4WebRole.Views.User.Resources

<div class="userPage page" id="user" ng-controller="UserCtrl" ng-class="{ myPage : profile.isSelf }">
    <div class="upContentWpr">
        <div class="upTop">
            <a class="rFloat iconTxt" target="_self" ng-if="profile.isSelf"
               href="@Url.Action("Settings","Account")">@UserResources.EditAccount</a>
            <img class="upImg" id="upUserImg" src="@Model.Image" width="100" height="100" alt="" />
            <h1 class="semiFont" id="upUsername">@Model.Name</h1>
            <div class="upSchool" id="upUserSchool">@Model.UniversityName</div>
            <button id="upSendMessage" type="button" class="btn3" ng-if="!profile.isSelf">@SharedResources.Message</button>
        </div>

        @if (ViewBag.Admin)
        {
            <section class="upMembers" ng-if="admin.visible()">
                <h2>@UserResources.UniMembers</h2>
                <div class="membersContent" ng-class="{noResults : admin.members.list && !admin.members.list.length}">
                    <div class="membersTop">
                        <input id="upMemberSettings" ng-checked="admin.members.selectAll" ng-click="toggleSelectAll()" type="checkbox" class="checkbox" />
                        <label for="upMemberSettings" class="cbLabel">@SharedResources.All</label>
                        <button type="button" class="btn3 messageBtn" ng-click="sendMembersMessage()" ng-show="admin.members.selected > 0">@SharedResources.Message</button>
                        <div class="searchWpr rFloat">
                            <span class="membersCount lFloat">{{admin.members.fullList.length + ' @SharedResources.Members'}}</span>
                            <div class="inputWpr">
                                <input class="membersSearch" type="search" ng-placeholder="@Zbang.Cloudents.Mvc4WebRole.Views.Box.Resources.IndexResources.SearchMember" ng-keyup="filterMembers()" ng-model="admin.members.search" />
                            </div>
                        </div>
                    </div>
                    <div class="memberTopRow">
                        <span class="memberCol">@SharedResources.Name</span>
                        <input type="checkbox" class="checkbox" id="cbDept" />

                        <span class="dateCol">@UserResources.JoinDate</span>
                        <span class="courseCol">@SharedResources.Courses</span>
                        <label for="cbDept" class="deptCol">@SharedResources.Department</label>
                        <div id="deptPopup" class="deptPopup">
                            <ul>

                                <li ng-repeat="department in admin.departments">
                                    <input id="{{'dep_' + department.id}}" ng-class="{selected : department.isChecked}" type="checkbox" class="checkbox" ng-model="department.isChecked" />
                                    <label for="{{'dep_' + department.id}}" class="cbLabel">{{department.name + ' ' + department.year}}</label>
                                </li>

                            </ul>
                        </div>
                    </div>
                    <ul class="upMembersList" infinite-scroll="addMembersLimit()" infinite-scroll-distance="2" infinite-scroll-immediate-check="false" infinite-scroll-element="true" load-spinner="admin.members.loading">
                        <li class="memberItem" ng-repeat="member in admin.members.list | limitTo : admin.members.limit">
                            <input id="{{'mbr_' + member.id}}" type="checkbox" class="checkbox" ng-model="member.isChecked" ng-change="toggleSelectMember(member)" />
                            <label for="{{'mbr_' + member.id}}" class="cbLabel memberCol">
                                <img class="friendImg calloutTrgr" alt="" ng-src="{{member.image}}" width="34" height="34" />
                                <span class="upMemberName elps">{{member.name}}</span>
                            </label>

                            <span class="dateCol">{{member.joinDate | date:'dd/MM/yyyy'}}</span>
                            <span class="courseCol"><span class="courseList"></span></span>
                            <span class="deptCol elps">{{member.department}}</span>

                        </li>
                        <li class="upMemberBoxesWpr">
                            <div class="upMemberBoxes">
                                <div class="upMemberBoxesTitle semiFont">@UserResources.CoursesList</div>
                                <ul class="upMemberBoxList" id="upMemberBoxList"></ul> @*//TODO*@
                                <div class="arrow downArrow"></div>
                            </div>
                        </li>
                    </ul>
                    <div class="emptySearch emptySearchAdmin">@SharedResources.NoResults</div>
                </div>
            </section>
        }
        <aside class="upSidebar rFloat">
            <section ng-if="!admin.visible()">
                <h2>@SharedResources.Points</h2>
                <div class="pointsWpr" id="pointsWpr">
                    <ul class="pointsList" data-score="@Model.Score">
                        <li class="point"></li>
                        <li class="point"></li>
                        <li class="point"></li>
                        <li class="point"></li>
                        <li class="point"></li>
                        <li class="point"></li>
                    </ul>

                    <div class="emptyPoints">
                        <div class="semiFont">@UserResources.EarnBy</div>
                        <p>@UserResources.PointsTxt9</p>
                        <p>@UserResources.PointsTxt2</p>
                        <p>@UserResources.PointsTxt1</p>
                        <p>@UserResources.PointsTxt7</p>
                        <p>@UserResources.PointsTxt6</p>
                        <p>@UserResources.PointsTxt3</p>
                        <p>@UserResources.PointsTxt4</p>
                        <p>@UserResources.PointsTxt5</p>
                        <p>@UserResources.PointsTxt8</p>
                    </div>
                </div>
            </section>

            <section class="upUploads">
                <h2>@SharedResources.Activity</h2>
                @*Guy: please add class upTab1/uptab2/upTab3 to the upTabs element according to which tab is clicked*@
                <div class="upTabs upTab1">
                    <button type="button" id="filesCount" class="fileCount" data-label="@SharedResources.Files"></button><span> | </span>
                    <button type="button" id="questionsCount" class="qCount" data-label="@SharedResources.Questions"></button><span> | </span>
                    <button type="button" id="answersCount" class="aCount" data-label="@SharedResources.Answers"></button>
                </div>

                <div id="filesSection" class="upTabContent filesTab" data-bind="css : filesEmpty">
                    <ul>
                        <!--ko foreach:files.slice(0,maxFiles())-->
                        <li class="uploadsItem">
                            <a data-navigation="item" data-bind="attr : { href : url }">
                                <img class="upImg" alt="" width="55" height="67" data-bind="attr : { src : image }" />
                                <div class="boxName clamp2" data-bind="text: name"></div>
                                <div class="stars">
                                    <div class="full" data-bind="style: { width : $root.fileRating(rating) }"></div>
                                </div>
                                <div tooltip="@SharedResources.Views" class="views" data-bind="text: views"></div>
                            </a>
                        </li>
                        <!--/ko-->
                    </ul>
                    <!--ko if:filesShowMoreVisible()-->
                    <button class="qaMore" type="button" data-click="showMoreFiles">@SharedResources.ShowMore</button>
                    <!--/ko-->
                    <div class="emptyUploads emptyTab">@UserResources.NoFiles</div>
                </div>

                <div id="questionsSection" class="upTabContent qTab" data-bind="css : questionsEmpty">
                    <ul>
                        <!--ko foreach:questions.slice(0,maxQuestions())-->
                        <li class="qaItem">
                            <img class="lFloat imgBorder" src="" alt="" width="28" height="36" data-bind="attr : { src : boxImage }" />
                            <span class="qaBoxname elps" data-bind="text: boxName"></span>
                            <div class="qaWpr">
                                <div class="qaQuestion" data-bind="html: content"></div>
                                <a class="qLink rFloat" href="" data-navigation="box" data-bind="attr : { href : url }">@UserResources.GotoQuestion</a>
                                <span class="qAnswerCount" data-bind="attr : { 'data-up-qacount' : answersCount}">&nbsp;@SharedResources.Answers</span>
                            </div>
                        </li>
                        <!--/ko-->
                    </ul>
                    <!--ko if:questionsShowMoreVisible()-->
                    <button class="qaMore" type="button" data-click="showMoreQuestions">@SharedResources.ShowMore</button>
                    <!--/ko-->
                    <div class="emptyQuestions emptyTab">@UserResources.NoQuestions</div>
                </div>

                <div id="answersSection" class="upTabContent aTab" data-bind="css: answersEmpty">
                    <ul>
                        <!--ko foreach:answers.slice(0,maxAnswers())-->
                        <li class="qaItem">
                            <img class="lFloat imgBorder" src="" alt="" width="28" height="36" data-bind="attr : { src : boxImage }" />
                            <span class="qaBoxname elps" data-bind="text: boxName"></span>
                            <div class="qaWpr">
                                <img class="lFloat imgBorder" src="" alt="" width="33" height="33" data-bind="attr : { src : qUserImage }" />
                                <span class="qaUsername semiFont elps" data-bind="text: qUserName"></span>
                                <div class="qaQuestion" data-bind="html: qContent"></div>
                                <div class="answeredBy elps" data-bind="text: $root.name"></div>
                                <div data-bind="html: content"></div>
                                <a class="qLink rFloat" href="" data-navigation="box" data-bind="attr : { href : url }">@UserResources.GotoQuestion</a>
                                <span class="qAnswerCount" data-bind="attr : { 'data-up-qacount' : answersCount}">&nbsp;@SharedResources.Answers</span>
                            </div>
                        </li>
                        <!--/ko-->
                    </ul>
                    <!--ko if:answersShowMoreVisible()-->
                    <button class="qaMore" type="button" data-click="showMoreAnswers">@SharedResources.ShowMore</button>
                    <!--/ko-->
                    <div class="emptyAnswers emptyTab">@UserResources.NoAnswers</div>
                </div>


            </section>
        </aside>

        <div class="upContent">
            <section class="upCourses" data-bind="visible: CoursesSectionVisible() , css: { noCourses : emptyBoxes()}">
                <h2>@UserResources.CoursesGroups</h2>
                <div id="upCoursesSection" class="upSectionWpr" data-bind="css: { truncated : !CoursesShowAllVisible()}">
                    <!--ko if:commonBoxesVisible()-->
                    <h4 class="semiFont">@UserResources.InCommon</h4>
                    <ul class="inCommonList clearfix">
                        <!--ko foreach:commonBoxes.slice(0,maxCommonBoxes())-->
                        <li class="box">
                            <a data-bind="attr: { href : url }" data-navigation="box">
                                <img class="boxImg" alt="" width="74" height="98" src="" data-bind="attr:{ 'data-src':image }">
                                <div class="boxWpr clamp2">
                                    <span data-bind="text: name" class="boxName"></span>
                                </div>
                            </a>
                        </li>
                        <!--/ko-->
                    </ul>
                    <!--/ko-->
                    <!--ko if:followingBoxesVisible() -->
                    <!--ko if:commonBoxes().length > 0-->
                    <h4 class="semiFont">@SharedResources.Following</h4>
                    <!--/ko-->
                    <ul class="followingList">
                        <!--ko foreach:followingBoxes.slice(0,maxFollowingBoxes())-->
                        <li class="box">
                            <a data-bind="attr: { href: url }" data-navigation="box">
                                <img class="boxImg" alt="" width="74" height="98" src="" data-bind="attr:{ 'data-src':image }">
                                <div class="boxWpr clamp2">
                                    <span class="boxName" data-bind="text: name"></span>
                                </div>
                            </a>
                            <button type="button" class="btn3" data-click="followBox">@SharedResources.Join</button>
                        </li>
                        <!--/ko-->
                    </ul>
                    <!--/ko-->
                    <div class="coursesEmpty">@UserResources.NotFollowing</div>
                </div>
            </section>
            <!--ko if:CoursesShowAllVisible()-->
            <input type="checkbox" class="upCb" id="coursesShow" />
            <label id="coursesShowLabel" for="coursesShow" data-up-showall="@SharedResources.ShowAll" data-up-showless="@SharedResources.ShowLess" class="upShowAll"></label>
            <!--/ko-->
            <section data-bind="visible: friendSectionVisible()" class="upFriends">
                <h2>@SharedResources.Friends</h2>
                <div id="upFriendsSection" class="upSectionWpr" data-bind="css: { truncated : !friendsShowAllVisible()}">

                    <!--ko if:commonFriendsVisible()-->
                    <!--ko ifnot:viewSelf()-->
                    <h4 class="semiFont">@UserResources.InCommon</h4>
                    <!--/ko-->
                    <ul class="inCommonList">
                        <!--ko foreach:commonFriends.slice(0,maxCommonFriends())-->
                        <li class="userItem calloutTrgr" data-bind="attr: { 'data-uid' : id }">
                            <a data-navigation="user" data-bind="attr : { href : url}"><img class="userItemImg" data-bind="attr: {'data-src' : image}" src="" width="74" height="74" /></a>
                            <div class="userItemName" data-bind="text: name"></div>
                        </li>
                        <!--/ko-->
                    </ul>
                    <!--/ko-->
                    <!--ko if:allFriendsVisible()-->
                    <!--ko:ifcommonFriends().length > 0-->
                    <h4 class="semiFont">@UserResources.AllFriends</h4>
                    <!--/ko-->
                    <ul class="inAllFriendList">
                        <!--ko foreach:allFriends.slice(0,maxAllFriends())-->
                        <li class="userItem calloutTrgr" data-bind="attr: { 'data-uid' : id }">
                            <a href="" data-navigation="user" data-bind="attr : { href : url } "><img class="userItemImg" data-bind="attr: {'data-src' : image }" src="" width="74" height="74" /></a>
                            <div class="userItemName" data-bind="text: name"></div>
                        </li>
                        <!--/ko-->
                    </ul>
                    <!--/ko-->
                </div>

            </section>
            <!--ko if:friendsShowAllVisible()-->
            <input type="checkbox" class="upCb" id="friendsShow">
            <label id="friendsShowLabel" for="friendsShow" data-up-showall="@SharedResources.ShowAll" data-up-showless="@SharedResources.ShowLess" class="upShowAll"></label>
            <!--/ko-->

            <section class="upInvites" data-bind="visible: viewSelf(), css : invitesEmpty()">
                <a data-navigation="invite"
                   href="@Url.RouteUrl("Invite")" class="inviteFriendBtn btn3 rFloat">@SharedResources.InviteFriends</a>
                <h2>@SharedResources.Invites</h2>
                <div id="upInvitesSection" class="upSectionWpr" data-bind="css: { truncated : !invitesShowAllVisible()}">

                    <ul id="upInviteList" class="upInviteList" data-up-pending="@SharedResources.Pending" data-up-joined="@SharedResources.ActiveMember">
                        <!--ko foreach:invites.slice(0,maxInvites())-->
                        <li class="upInviteItem" data-bind="css : $root.invitePending(status)">
                            <img class="userItemImg" width="74" height="74" data-bind="attr : { 'data-src' : userImage }" />
                            <div class="usrName semiFont elps" data-bind="text : userName"></div>
                            <div class="inviteStatus" data-bind="text: $root.inviteStatus(status)"></div>
                            <div class="invitedToWpr">
                                <img class="upImg" alt="" width="28" height="36" data-bind="attr : { 'data-src' : inviteImage }" />
                                <div class="invitedTo" data-bind="text : name"></div>
                            </div>
                            <button type="button" class="btn1" data-bind="visible : inviteType === 'invite'" data-click="reInvite" data-inv-sent="@SharedResources.Sent">@SharedResources.Reinvite</button>
                        </li>
                        <!--/ko-->

                    </ul>

                    <div class="emptyInvites">
                        <span>@UserResources.FindFriends</span>
                        <a data-navigation="invite" href="@Url.RouteUrl("Invite")" class="inviteFriendBtn btn3">@SharedResources.InviteFriends</a>
                    </div>

                </div>
            </section>
            <!--ko if:invitesShowAllVisible()-->
            <input type="checkbox" class="upCb" id="invitesShow">
            <label id="invitesShowLabel" for="invitesShow" data-up-showall="@SharedResources.ShowAll" data-up-showless="@SharedResources.ShowLess" class="upShowAll"></label>
            <!--/ko-->

        </div>


    </div>
</div>

<script type="text/html" id="upMemberBoxItemTemplate">
    <li class="elps">{{name}}</li>
</script>