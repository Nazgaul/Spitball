@using Zbang.Cloudents.Mvc4WebRole.Views.Shared.Resources
<div  ng-if="app.loadChat" ng-cloak class="chat" ng-controller="ChatController as c">
    <div class="content" ng-cloak ng-class="{stateChat: c.state === c.states.chat}">
        <div class="error" ng-class="{disconnected : !c.connected}">
            <div>@ChatResources.DisconnectedHeader</div>
            <div>
                <span>@ChatResources.DisconnectedText</span>
            </div>
        </div>
        <div class="menu-content angular-animate backgroundTC33">
            <div class="tab-content" ng-if="c.state === c.states.messages">
                <form novalidate class="search-friend" ng-submit="c.search(c.term)">
                    <button type="button" class="search-btn" ng-click="c.expandChat(); c.focusSearch=true">
                        @Html.Svg("~/images/site/icons.svg", "searchIcon", new { @class = "searchIcon" })
                    </button>
                    <input type="search" focus-me="c.focusSearch" placeholder="@ChatResources.FriendSearchPlaceholder" ng-model="c.term" ng-change="c.search(c.term)" ng-model-options="{debounce : 300}" />
                    <button type="reset" ng-if="c.term.length" class="reset-btn" ng-click="c.term=''; c.search('')">
                        @Html.Svg("~/images/site/icons.svg", "close", new { @class = "resetIcon" })
                    </button>
                </form>
                <div class="users-list" disable-thouch ng-scrollbars infinite-scrollbars-direction="down" infinite-scrollbars-function="c.usersPaging" ng-scrollbars-config="c.scrollSetting">
                    <section class="favorits">
                        <div class="header">
                            @Html.Svg("~/images/site/icons.svg", "star")
                            <h1>@ChatResources.FavoritsHeader</h1>
                        </div>
                        <ul class="users-sub-list">
                            <li ng-click="c.chat(e)" class="user" ng-repeat="e in c.users | filter: {section : 1 } track by e.id" ng-class="{online: e.online}" ga-track-event="['chat', 'started-conversation']" ng-include="'chat-user-template.html'">
                            </li>
                        </ul>
                    </section>
                    <section class="classmates">
                        <div class="header">
                            @Html.Svg("~/images/site/icons.svg", "group")
                            <h1>@ChatResources.ClassmatesHeader</h1>
                        </div>

                        <ul class="users-sub-list" >
                            <li ng-click="c.chat(e)" class="user" ng-repeat="e in c.users | filter: {section : 2 } track by e.id" ng-class="{online: e.online}" ga-track-event="['chat', 'started-conversation']" ng-include="'chat-user-template.html'">
                            </li>
                            
                        </ul>
                    </section>
                    <section class="schoolmates">
                        <div class="header">
                            @Html.Svg("~/images/site/icons.svg", "crowd")
                            <h1>@ChatResources.SchoolmatesHeader</h1>
                        </div>
                        <ul class="users-sub-list" ng-if="c.users.length">
                            <li ng-click="c.chat(e)" class="user" ng-repeat="e in c.users | filter: {section : 3 } track by e.id" ng-class="{online: e.online}" ga-track-event="['chat', 'started-conversation']" ng-include="'chat-user-template.html'">
                            </li>
                            
                        </ul>
                    </section>
                </div>
                <div class="empty-state" ng-if="!c.users.length && c.term">
                    <div>
                        @Html.Svg("~/images/site/icons.svg", "sad-student-smiley")
                    </div>
                    <span class="title">@ChatResources.EmptyStateTitle</span>
                    <span class="subtitle">@ChatResources.EmptyStateSubtitle</span>
                </div>
            </div>
        </div>
        <div class="conversasion angular-animate" ng-if="c.state === c.states.chat">
            <div class="header backgroundTC37">
                <a ng-href="{{c.userChat.url}}" ng-class="{online: c.userChat.online}" class="user" ga-track-event="['chat', 'opened-partners-profile']">
                    <user-image class="img-circle" name="c.userChat.name" image="c.userChat.image" width="35" height="35" noremove="true"></user-image>

                    <span class="member-name ellipsis" ng-bind="c.userChat.name"></span>

                </a>
                <div class="back" ng-click="c.backFromChat()">
                    <div class="close"></div>
                </div>
            </div>
            <div class="chat-content">
                <ul class="messages" disable-thouch ng-scrollbars ng-scrollbars-update="c.updateScrollbar" ng-scrollbars-config="c.scrollSetting" @*infinite-scrollbars-direction="up" infinite-scrollbars-function="c.loadMoreMessages"*@ @*ng-slimscroll height="calc(100vh - 120px)" start="bottom" watch-content="true" color="#BBB"*@>
                    <li class="message" ng-repeat="e in c.messages" ng-class="{partner: e.partner}">
                        <div ng-if="e.text" class="text" ng-bind-html="::e.text | linky:'_blank'"></div>
                        <div ng-if="e.blob" class="image" ng-click="c.dialog(e.blob, $event)" ga-track-event="['chat', 'opened-attachment']">
                            <img ng-src="{{e.thumb}}" width="256" height="138" alt="preview" />
                        </div>
                        <time-ago class="time" from-time="{{::e.time}}" format="mediumDate"></time-ago>
                    </li>
                </ul>
                <div class="new-message">
                    <a class="menu menu-item" plupload="c.upload.url" plupload-options="c.upload.options" plupload-callbacks="c.upload.callbacks" href="#" ga-track-event="['chat', 'upload-file']"> @Html.Svg("~/images/site/uploadIcons.svg", "file", new { @class = "attach" }) </a>

                    <form name="chatDialog" novalidate ng-submit="c.send()">
                        <md-input-container md-no-float="false">
                            <textarea autofocus enter-submit="c.send()" autocomplete="off" type="text" maxlength="16000" required ng-model="c.newText" placeholder="@ChatResources.NewMessagePlaceholder"></textarea>
                        </md-input-container>
                        <button type="submit" class="btn blue-button" ng-disabled="c.disabled" ga-track-event="['chat', 'sent-message']">
                            @Html.Svg("~/images/site/uploadIcons.svg", "post")
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <button type="button" class="tab" ng-click="c.toggleChat()"></button>
    <script type="text/ng-template" id="chat-user-template.html">
        <span ng-if="e.unread" class="chat-counter" ng-bind="e.unread"></span>
        <user-image class="img-circle" name="::e.name" image="::e.image" width="40" height="40"></user-image>
        <div class="name-date textTC34">
            <span class="member-name ellipsis" ng-bind="::e.name"></span>
            <chat-time-ago ng-if="!e.online" class="comment-date" from-time="{{e.lastSeen }}" format="mediumDate"></chat-time-ago>
        </div>
    
    </script>
</div>