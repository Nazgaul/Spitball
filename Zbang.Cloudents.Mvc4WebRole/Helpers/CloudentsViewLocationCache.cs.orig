using System;
using System.Web.Caching;
using System.Web.Mvc;
using Zbang.Zbox.Infrastructure.Trace;

namespace Zbang.Cloudents.Mvc4WebRole.Helpers
{
    public class CloudentsViewLocationCache : IViewLocationCache
    {
      //  const string CacheRegion = "MVC";
       // readonly Zbox.Infrastructure.Cache.ICache m_Cache;
        //public CloudentsViewLocationCache()
        //{
        //  //  m_Cache = DependencyResolver.Current.GetService<Zbox.Infrastructure.Cache.ICache>();
        //}


        public string GetViewLocation(System.Web.HttpContextBase httpContext, string key)
        {
            try
            {
                var localCacheValue = (string)httpContext.Cache[key];
<<<<<<< HEAD
                //if (localCacheValue == null)
                //{
                //    localCacheValue = (string)m_Cache.GetFromCache(key, CacheRegion);
                //}
=======
                if (localCacheValue == null)
                {
                    localCacheValue = (string)m_Cache.GetFromCache(key, CacheRegion);
                }
>>>>>>> 311725ccdac0f408e9332e71be229d4ae7085da5
                return localCacheValue;
            }
            catch (Exception ex)
            {

                TraceLog.WriteError("GetViewLocation", ex);
                return (string)httpContext.Cache[key];
            }
        }

        public void InsertViewLocation(System.Web.HttpContextBase httpContext, string key, string virtualPath)
        {
            try
            {
<<<<<<< HEAD
               // m_Cache.AddToCache(key, virtualPath, TimeSpan.FromDays(2), CacheRegion);
                httpContext.Cache.Insert(key, virtualPath, null /* dependencies */, Cache.NoAbsoluteExpiration, TimeSpan.FromDays(2));
=======
                httpContext.Cache.Insert(key, virtualPath, null /* dependencies */, Cache.NoAbsoluteExpiration, TimeSpan.FromDays(2));
                m_Cache.AddToCache(key, virtualPath, TimeSpan.FromDays(2), CacheRegion);
               
>>>>>>> 311725ccdac0f408e9332e71be229d4ae7085da5
            }
            catch (Exception ex)
            {
                TraceLog.WriteError("InsertViewLocation", ex);
                httpContext.Cache.Insert(key, virtualPath, null /* dependencies */, Cache.NoAbsoluteExpiration, TimeSpan.FromDays(2));
            }

        }
    }
}