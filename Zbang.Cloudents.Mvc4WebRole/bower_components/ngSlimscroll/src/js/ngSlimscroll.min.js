angular.module("jkuri.slimscroll",[]).directive("ngSlimscroll",["$document","$window","$compile",function(n,t,i){"use strict";var r=function(n,t,i){var r=undefined;r=i.height!==0&&i.height!==undefined?i.height:t[0].clientHeight!==0?t[0].clientHeight:250;n.width=i.width||t[0].clientWidth||"auto";n.height=r;n.size=i.size||"7px";n.color=i.color||"#000";n.position=i.position||"right";n.distance=i.distance||"1px";n.borderRadius=i.borderRadius||"3px";n.start=i.start||"top";n.alwaysVisible=n.$eval(i.alwaysVisible)||!0;n.barDraggable=n.$eval(i.barDraggable)||!0;n.wheelStep=i.wheelStep||20;n.opacity=i.opacity||.5;n.enabled=n.$eval(i.enabled)||!0;n.horizontalScroll=n.$eval(i.horizontalScroll)||!1;n.horizontalScrollPosition=i.horizontalScrollPosition||"bottom";n.touchScrollStep=i.touchScrollStep||200;n.watchContent=n.$eval(i.watchContent)||!1};return{restrict:"A",scope:!0,link:function(u,f,e){var a,o,c,v,y;r(u,f,e);var s=f[0],p=30,h=!1,l,w=30;f.css({overflow:"hidden",width:u.width,height:u.height});a=angular.element("<div><\/div>");a.css({position:"relative",overflow:"hidden",width:u.width,height:u.height});u.horizontalScroll?(o=angular.element('<div ng-mousedown="makeBarDraggableHorizontal($event)"><\/div>'),o.css({background:u.color,height:u.size,position:"absolute",left:"0",opacity:u.opacity,display:u.alwaysVisible?"block":"none","border-radius":u.borderRadius,"z-index":"99",cursor:"pointer"}),c=u.horizontalScrollPosition==="bottom"?{bottom:u.distance}:{top:u.distance},o.css(c)):(o=angular.element('<div ng-mousedown="makeBarDraggable($event)""><\/div>'),o.css({background:u.color,width:u.size,position:"absolute",top:"0",opacity:u.opacity,display:u.alwaysVisible?"block":"none","border-radius":u.borderRadius,"z-index":"99",cursor:"pointer"}),c=u.position==="right"?{right:u.distance}:{left:u.distance},o.css(c));f.wrap(a);f.append(o);i(o)(u);u.makeBarDraggable=function(){o.bind("mousedown",function(t){var i=parseFloat(o.css("top")),r=t.pageY,f=!0;n.bind("mousemove",function(n){o.css({top:i+n.pageY-r+"px"});u.scrollContent(0,o[0].offsetTop,!1)});n.bind("mouseup",function(){f=!1;n.unbind("mousemove")});return}).bind("selectstart",function(n){return n.preventDefault(),n.stopPropagation(),!1})};u.makeBarDraggableHorizontal=function(){o.bind("mousedown",function(t){var i=parseFloat(o.css("left")),r=t.pageX,f=!0;n.bind("mousemove",function(n){o.css({left:i+n.pageX-r+"px"});u.scrollContentHorizontal(0,o[0].offsetLeft,!1)});n.bind("mouseup",function(){f=!1;n.unbind("mousemove")});return}).bind("selectstart",function(n){return n.preventDefault(),n.stopPropagation(),!1})};u.getBarHeight=function(){var n=Math.max(s.offsetHeight/s.scrollHeight*s.offsetHeight,p),t;o.css({height:n+"px"});t=n===s.offsetHeight?"none":"block";o.css({display:t})};u.getBarWidth=function(){var n=Math.max(s.offsetWidth/s.scrollWidth*s.offsetWidth,w),t;o.css({width:n+"px"});t=n===s.offsetWidth?"none":"block";o.css({display:t})};u.attachWheel=function(i){t.addEventListener?(i.addEventListener("DOMMouseScroll",u.onWheel,!1),i.addEventListener("mousewheel",u.onWheel,!1)):n.addEventListener("onmousewheel",u.onWheel)};u.detachWheel=function(i){t.removeEventListener?(i.removeEventListener("DOMMouseScroll",u.onWheel,!1),i.removeEventListener("mousewheel",u.onWheel,!1)):n.removeEventListener("onmousewheel",u.wheel)};u.onWheel=function(n){var n=n||t.event,i=0,r;n.wheelDelta&&(i=-n.wheelDelta/120);n.detail&&(i=n.detail/3);r=n.target||n.srcTarget||n.srcElement;u.horizontalScroll?u.scrollContentHorizontal(i,!0):u.scrollContent(i,!0);n.preventDefault&&!h&&n.preventDefault();h||(n.returnValue=!1)};u.scrollContent=function(n,t){h=!1;var i=n,f=s.offsetHeight-o[0].offsetHeight,r;t&&(i=parseInt(o.css("top"),10)+n*parseInt(u.wheelStep,10)/100*o[0].offsetHeight,i=Math.min(Math.max(i,0),f),i=n>0?Math.ceil(i):Math.floor(i),o.css({top:i+"px"}));r=parseInt(o.css("top"),10)/(s.offsetHeight-o[0].offsetHeight);i=r*(s.scrollHeight-s.offsetHeight);s.scrollTop=i};u.scrollContentHorizontal=function(n,t){h=!1;var i=n,f=s.offsetWidth-o[0].offsetWidth,r;t&&(i=parseInt(o.css("left"),10)+n*parseInt(u.wheelStep,10)/100*o[0].offsetWidth,i=Math.min(Math.max(i,0),f),i=n>0?Math.ceil(i):Math.floor(i),o.css({left:i+"px"}));r=parseInt(o.css("left"),10)/(s.offsetWidth-o[0].offsetWidth);i=r*(s.scrollWidth-s.offsetWidth);s.scrollLeft=i};f.bind("touchstart",function(n){n.touches.length&&(l=n.touches[0].pageY)});f.bind("touchmove",function(n){if(h||n.preventDefault(),n.touches.length){var t=(l-n.touches[0].pageY)/u.touchScrollStep;u.horizontalScroll?u.scrollContentHorizontal(t,!0):u.scrollContent(t,!0);l=n.touches[0].pageY}});e.$observe("enabled",function(){u.enabled=u.$eval(e.enabled);u.enabled===!1?(o.remove(),u.detachWheel(s)):(f.append(o),u.attachWheel(s))});u.watchContent&&(v=u.$watch(function(){return f.html()},function(){u.init()}),y=u.$watch(function(){return t.innerWidth},function(){u.init()}),u.$on("$destroy",function(){v();y()}));u.init=function(){return u.horizontalScroll?(u.getBarWidth(),u.makeBarDraggableHorizontal()):(u.getBarHeight(),u.makeBarDraggable()),u.attachWheel(s),!0};u.init()}}}]);