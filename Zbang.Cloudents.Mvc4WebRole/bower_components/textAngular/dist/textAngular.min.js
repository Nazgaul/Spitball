/*
@license textAngular
Author : Austin Anderson
License : 2013 MIT
Version 1.4.6
See README.md or https://github.com/fraywing/textAngular/wiki for requirements and use.
*/
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="textAngular"),function(){"use strict";var n={ie:function(){for(var i,n=3,t=document.createElement("div"),r=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+ ++n+"]><i><\/i><![endif]-->",r[0];);return n>4?n:i}(),webkit:/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent)},o=!1,i,h,c,l,a,v,u,r,e,f;n.webkit&&(document.addEventListener("mousedown",function(n){var u=n||window.event,i=u.target,r,t;if(o&&i!==null){for(r=!1,t=i;t!==null&&t.tagName.toLowerCase()!=="html"&&!r;)r=t.contentEditable==="true",t=t.parentNode;r||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),i.focus(),i.select&&i.select())}o=!1},!1),angular.element(document).ready(function(){angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" class="ta-hidden-input" aria-hidden="true" unselectable="on" tabIndex="-1">'))}));var t=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,y=/^(ul|li|ol)$/i,s=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;if(String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),n.ie>8||n.ie===undefined){for(u=document.styleSheets,r=0;r<u.length;r++)if((u[r].media.length===0||u[r].media.mediaText.match(/(all|screen)/ig))&&u[r].href&&u[r].href.match(/textangular\.(min\.|)css/ig)){i=u[r];break}i||(i=function(){var t=document.createElement("style");return n.webkit&&t.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(t),t.sheet}());h=function(n,t){return l(i,n,t)};l=function(n,t,r){var u,f;return n.cssRules?u=Math.max(n.cssRules.length-1,0):n.rules&&(u=Math.max(n.rules.length-1,0)),n.insertRule?n.insertRule(t+"{"+r+"}",u):n.addRule(t,r,u),i.rules?f=i.rules[u]:i.cssRules&&(f=i.cssRules[u]),f};v=function(n,t){for(var r,i=0;i<t.length;i++)if(t[i].cssText===n.cssText){r=i;break}return r};c=function(n){a(i,n)};a=function(n,t){var i=n.cssRules||n.rules,r;i&&i.length!==0&&(r=v(t,i),n.removeRule?n.removeRule(r):n.deleteRule(r))}}angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(t){return t?t===""?n.ie===undefined?"div":n.ie<=8?"P":"p":n.ie<=8?t.toUpperCase():t:n.ie<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(n,t){return function(i){var r=angular.element("<div><\/div>");return r[0].innerHTML=i,angular.forEach(n,function(n){var i=[];n.selector&&n.selector!==""?i=r.find(n.selector):n.customAttribute&&n.customAttribute!==""&&(i=t.getByAttribute(r,n.customAttribute));angular.forEach(i,function(t){t=angular.element(t);n.selector&&n.selector!==""&&n.customAttribute&&n.customAttribute!==""?t.attr(n.customAttribute)!==undefined&&n.renderLogic(t):n.renderLogic(t)})}),r[0].innerHTML}}]).factory("taFixChrome",function(){return function(n){if(!n||!angular.isString(n)||n.length<=0)return n;for(var e=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/ig,t,i,r,f="",u=0;t=e.exec(n);)i=t[3]||t[4],i&&i.match(/line-height: 1.[0-9]{3,12};|color: inherit; line-height: 1.1;/i)&&(i=i.replace(/( |)font-family: inherit;|( |)line-height: 1.[0-9]{3,12};|( |)color: inherit;/ig,""),r="<"+t[1].trim(),i.trim().length>0&&(r+=" style="+t[2].substring(0,1)+i+t[2].substring(0,1)),r+=t[5].trim()+">",f+=n.substring(u,t.index)+r,u=t.index+t[0].length);return f+=n.substring(u),u>0?f.replace(/<span\s?>(.*?)<\/span>(<br(\/|)>|)/ig,"$1"):n}}).factory("taSanitize",["$sanitize",function(n){function o(n,t){for(var i=0,r=0,u,f=/<[^>]*>/ig;u=f.exec(n);)if(r=u.index,u[0].substr(1,1)==="/")if(i===0)break;else i--;else i++;return t+n.substring(0,r)+angular.element(t)[0].outerHTML.substring(t.length)+n.substring(r)}function s(n){var y,p;if(!n||!angular.isString(n)||n.length<=0)return n;for(var u,w=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/ig,i,v,r,l,e="",a,h="",c=0;i=w.exec(n);)if(r=i[3]||i[4],y=new RegExp(f,"i"),angular.isString(r)&&y.test(r)){for(l="",p=new RegExp(f,"ig");v=p.exec(r);)for(u=0;u<t.length;u++)!v[u*2+2]||(l+="<"+t[u].tag+">");a=s(n.substring(c,i.index));h+=e.length>0?o(a,e):a;r=r.replace(new RegExp(f,"ig"),"");h+="<"+i[1].trim();r.length>0&&(h+=' style="'+r+'"');h+=i[5]+">";c=i.index+i[0].length;e=l}return h+(e.length>0?o(n.substring(c),e):n.substring(c))}function h(n){var i;if(!n||!angular.isString(n)||n.length<=0)return n;for(var f=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/ig,t,r="",u=0;t=f.exec(n);)r+=n.substring(u,t.index),u=t.index+t[0].length,i="<"+t[1]+t[5],/style=("([^"]+)"|'([^']+)')/ig.test(i)?i=i.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(t[3]||t[4])+';"'):i+=' style="text-align:'+(t[3]||t[4])+';"',i+=">",r+=i;return r+n.substring(u)}for(var r,u,f,t=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],e=[],i=0;i<t.length;i++){for(r="("+t[i].property+":\\s*(",u=0;u<t[i].values.length;u++)u>0&&(r+="|"),r+=t[i].values[u];r+=");)";e.push(r)}return f="("+e.join("|")+")",function(t,i,r){var u;if(!r)try{t=s(t)}catch(v){}t=h(t);try{u=n(t);r&&(u=t)}catch(v){u=i||""}var l=u.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/ig),e=u.replace(/(&#(9|10);)*/ig,""),a=/<pre[^>]*>.*?<\/pre[^>]*>/ig,o=0,c=0,f;for(u="";(f=a.exec(e))!==null&&o<l.length;)u+=e.substring(c,f.index)+l[o],c=f.index+f[0].length,o++;return u+e.substring(c)}}]).factory("taToolExecuteAction",["$q","$log",function(n,t){return function(i){i!==undefined&&(this.$editor=function(){return i});var r=n.defer(),e=r.promise,u=this.$editor(),f;try{f=this.action(r,u.startAction());e["finally"](function(){u.endAction.call(u)})}catch(o){t.error(o)}(f||f===undefined)&&r.resolve()}}]);angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(n,i,r){var u=function(t,i){for(var u,f=t.find("li"),r=f.length-1;r>=0;r--)u=angular.element("<"+i+">"+f[r].innerHTML+"<\/"+i+">"),t.after(u);t.remove();n.setSelectionToElementEnd(u[0])},e=function(t){/(<br(|\/)>)$/i.test(t.innerHTML.trim())?n.setSelectionBeforeElement(angular.element(t).find("br")[0]):n.setSelectionToElementEnd(t)},f=function(n,t){var i=angular.element("<"+t+">"+n[0].innerHTML+"<\/"+t+">");n.after(i);n.remove();e(i.find("li")[0])},o=function(n,t,r){for(var f,o="",u=0;u<n.length;u++)o+="<"+i("li")+">"+n[u].innerHTML+"<\/"+i("li")+">";f=angular.element("<"+r+">"+o+"<\/"+r+">");t.after(f);t.remove();e(f.find("li")[0])};return function(e,s){return e=i(e),function(h,c,l,a){var v,w,g,p,ht,nt,tt,it=angular.element("<"+e+">"),b,d,k,st,et,ft,ot,rt,ut,at;try{tt=n.getSelectionElement()}catch(yt){}if(b=angular.element(tt),tt!==undefined)if(d=tt.tagName.toLowerCase(),h.toLowerCase()==="insertorderedlist"||h.toLowerCase()==="insertunorderedlist"){if(k=i(h.toLowerCase()==="insertorderedlist"?"ol":"ul"),d===k)return u(b,e);if(d==="li"&&b.parent()[0].tagName.toLowerCase()===k&&b.parent().children().length===1)return u(b.parent(),e);if(d==="li"&&b.parent()[0].tagName.toLowerCase()!==k&&b.parent().children().length===1)return f(b.parent(),k);if(d.match(t)&&!b.hasClass("ta-bind"))return d==="ol"||d==="ul"?f(b,k):(st=!1,angular.forEach(b.children(),function(n){n.tagName.match(t)&&(st=!0)}),st?o(b.children(),b,k):o([angular.element("<div>"+tt.innerHTML+"<\/div>")[0]],b,k));if(d.match(t)){if(p=n.getOnlySelectedElements(),p.length===0)w=angular.element("<"+k+"><li>"+tt.innerHTML+"<\/li><\/"+k+">"),b.html(""),b.append(w);else{if(p.length===1&&(p[0].tagName.toLowerCase()==="ol"||p[0].tagName.toLowerCase()==="ul"))return p[0].tagName.toLowerCase()===k?u(angular.element(p[0]),e):f(angular.element(p[0]),k);for(g="",et=[],v=0;v<p.length;v++)if(p[v].nodeType!==3){if(ft=angular.element(p[v]),p[v].tagName.toLowerCase()==="li")continue;else g+=p[v].tagName.toLowerCase()==="ol"||p[v].tagName.toLowerCase()==="ul"?ft[0].innerHTML:p[v].tagName.toLowerCase()==="span"&&(p[v].childNodes[0].tagName.toLowerCase()==="ol"||p[v].childNodes[0].tagName.toLowerCase()==="ul")?ft[0].childNodes[0].innerHTML:"<"+i("li")+">"+ft[0].innerHTML+"<\/"+i("li")+">";et.unshift(ft)}w=angular.element("<"+k+">"+g+"<\/"+k+">");et.pop().replaceWith(w);angular.forEach(et,function(n){n.remove()})}n.setSelectionToElementEnd(w[0]);return}}else{if(h.toLowerCase()==="formatblock"){for(nt=l.toLowerCase().replace(/[<>]/ig,""),nt.trim()==="default"&&(nt=e,l="<"+e+">"),w=d==="li"?b.parent():b;!w[0].tagName||!w[0].tagName.match(t)&&!w.parent().attr("contenteditable");)w=w.parent(),d=(w[0].tagName||"").toLowerCase();if(d===nt){for(p=w.children(),ot=!1,v=0;v<p.length;v++)ot=ot||p[v].tagName.match(t);ot?(w.after(p),ht=w.next(),w.remove(),w=ht):(it.append(w[0].childNodes),w.after(it),w.remove(),w=it)}else if(w.parent()[0].tagName.toLowerCase()!==nt||w.parent().hasClass("ta-bind"))if(d.match(y))w.wrap(l);else{for(p=n.getOnlySelectedElements(),p.length===0&&(p=[w[0]]),v=0;v<p.length;v++)if(p[v].nodeType===3||!p[v].tagName.match(t))while(p[v].nodeType===3||!p[v].tagName||!p[v].tagName.match(t))p[v]=p[v].parentNode;if(angular.element(p[0]).hasClass("ta-bind"))w=angular.element(l),w[0].innerHTML=p[0].innerHTML,p[0].innerHTML=w[0].outerHTML;else if(nt==="blockquote"){for(g="",v=0;v<p.length;v++)g+=p[v].outerHTML;for(w=angular.element(l),w[0].innerHTML=g,p[0].parentNode.insertBefore(w[0],p[0]),v=p.length-1;v>=0;v--)p[v].parentNode&&p[v].parentNode.removeChild(p[v])}else for(v=0;v<p.length;v++)w=angular.element(l),w[0].innerHTML=p[v].innerHTML,p[v].parentNode.insertBefore(w[0],p[v]),p[v].parentNode.removeChild(p[v])}else{for(rt=w.parent(),ut=rt.contents(),v=0;v<ut.length;v++)rt.parent().hasClass("ta-bind")&&ut[v].nodeType===3&&(it=angular.element("<"+e+">"),it[0].innerHTML=ut[v].outerHTML,ut[v]=it[0]),rt.parent()[0].insertBefore(ut[v],rt[0]);rt.remove()}n.setSelectionToElementEnd(w[0]);return}if(h.toLowerCase()==="createlink"){var ct='<a href="'+l+'" target="'+(a.a.target?a.a.target:"")+'">',lt="<\/a>",vt=n.getSelection();vt.collapsed?n.insertHtml(ct+l+lt,s):rangy.getSelection().getRangeAt(0).canSurroundContents()&&(at=angular.element(ct+lt)[0],rangy.getSelection().getRangeAt(0).surroundContents(at));return}if(h.toLowerCase()==="inserthtml"){n.insertHtml(l,s);return}}try{r[0].execCommand(h,c,l)}catch(yt){}}}}]).service("taSelection",["$window","$document","taDOM",function(n,i,r){var f=i[0],u=n.rangy,o=function(n,t){return n.tagName&&n.tagName.match(/^br$/i)&&t===0&&!n.previousSibling?{element:n.parentNode,offset:0}:{element:n,offset:t}},e={getSelection:function(){var t=u.getSelection().getRangeAt(0),n=t.commonAncestorContainer,i={start:o(t.startContainer,t.startOffset),end:o(t.endContainer,t.endOffset),collapsed:t.collapsed};return n=n.nodeType===3?n.parentNode:n,i.container=n.parentNode===i.start.element||n.parentNode===i.end.element?n.parentNode:n,i},getOnlySelectedElements:function(){var t=u.getSelection().getRangeAt(0),n=t.commonAncestorContainer;return n=n.nodeType===3?n.parentNode:n,t.getNodes([1],function(t){return t.parentNode===n})},getSelectionElement:function(){return e.getSelection().container},setSelection:function(n,t,i){var r=u.createRange();r.setStart(n,t);r.setEnd(n,i);u.getSelection().setSingleRange(r)},setSelectionBeforeElement:function(n){var t=u.createRange();t.selectNode(n);t.collapse(!0);u.getSelection().setSingleRange(t)},setSelectionAfterElement:function(n){var t=u.createRange();t.selectNode(n);t.collapse(!1);u.getSelection().setSingleRange(t)},setSelectionToElementStart:function(n){var t=u.createRange();t.selectNodeContents(n);t.collapse(!0);u.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(n){var t=u.createRange();t.selectNodeContents(n);t.collapse(!1);n.childNodes&&n.childNodes[n.childNodes.length-1]&&n.childNodes[n.childNodes.length-1].nodeName==="br"&&(t.startOffset=t.endOffset=t.startOffset-1);u.getSelection().setSingleRange(t)},insertHtml:function(n,i){var o,c,l,k,p,a,g,w=angular.element("<div>"+n+"<\/div>"),h=u.getSelection().getRangeAt(0),v=f.createDocumentFragment(),y=w[0].childNodes,b=!0,d,nt;if(y.length>0){for(k=[],l=0;l<y.length;l++)y[l].nodeName.toLowerCase()==="p"&&y[l].innerHTML.trim()===""||y[l].nodeType===3&&y[l].nodeValue.trim()===""||(b=b&&!t.test(y[l].nodeName),k.push(y[l]));for(d=0;d<k.length;d++)a=v.appendChild(k[d]);!b&&h.collapsed&&/^(|<br(|\/)>)$/i.test(h.startContainer.innerHTML)&&h.selectNode(h.startContainer)}else b=!0,a=v=f.createTextNode(n);if(b)h.deleteContents();else if(h.collapsed&&h.startContainer!==i)if(h.startContainer.innerHTML&&h.startContainer.innerHTML.match(/^<[^>]*>$/i))o=h.startContainer,h.startOffset===1?(h.setStartAfter(o),h.setEndAfter(o)):(h.setStartBefore(o),h.setEndBefore(o));else{if(h.startContainer.nodeType===3&&h.startContainer.parentNode!==i)for(o=h.startContainer.parentNode,c=o.cloneNode(),r.splitNodes(o.childNodes,o,c,h.startContainer,h.startOffset);!s.test(o.nodeName);)angular.element(o).after(c),o=o.parentNode,nt=c,c=o.cloneNode(),r.splitNodes(o.childNodes,o,c,nt);else o=h.startContainer,c=o.cloneNode(),r.splitNodes(o.childNodes,o,c,undefined,undefined,h.startOffset);if(angular.element(o).after(c),h.setStartAfter(o),h.setEndAfter(o),/^(|<br(|\/)>)$/i.test(o.innerHTML.trim())&&(h.setStartBefore(o),h.setEndBefore(o),angular.element(o).remove()),/^(|<br(|\/)>)$/i.test(c.innerHTML.trim())&&angular.element(c).remove(),o.nodeName.toLowerCase()==="li"){for(g=f.createDocumentFragment(),p=0;p<v.childNodes.length;p++)w=angular.element("<li>"),r.transferChildNodes(v.childNodes[p],w[0]),r.transferNodeAttributes(v.childNodes[p],w[0]),g.appendChild(w[0]);v=g;a&&(a=v.childNodes[v.childNodes.length-1],a=a.childNodes[a.childNodes.length-1])}}else h.deleteContents();h.insertNode(v);a&&e.setSelectionToElementEnd(a)}};return e}]).service("taDOM",function(){var n={getByAttribute:function(t,i){var r=[],u=t.children();return u.length&&angular.forEach(u,function(t){r=r.concat(n.getByAttribute(angular.element(t),i))}),t.attr(i)!==undefined&&r.push(t),r},transferChildNodes:function(n,t){for(t.innerHTML="";n.childNodes.length>0;)t.appendChild(n.childNodes[0]);return t},splitNodes:function(t,i,r,u,f,e){if(!u&&isNaN(e))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var o=document.createDocumentFragment(),s=document.createDocumentFragment(),h=0;t.length>0&&(isNaN(e)||e!==h)&&t[0]!==u;)o.appendChild(t[0]),h++;for(!isNaN(f)&&f>=0&&t[0]&&(o.appendChild(document.createTextNode(t[0].nodeValue.substring(0,f))),t[0].nodeValue=t[0].nodeValue.substring(f));t.length>0;)s.appendChild(t[0]);n.transferChildNodes(o,i);n.transferChildNodes(s,r)},transferNodeAttributes:function(n,t){for(var i=0;i<n.attributes.length;i++)t.setAttribute(n.attributes[i].name,n.attributes[i].value);return t}};return n});angular.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){var u=parseInt(n.$eval(i.taMaxText));if(isNaN(u))throw"Max text must be an integer";i.$observe("taMaxText",function(n){if(u=parseInt(n),isNaN(u))throw"Max text must be an integer";r.$dirty&&r.$validate()});r.$validators.taMaxText=function(n){var t=angular.element("<div/>");return t.html(n),t.text().length<=u}}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){var u=parseInt(n.$eval(i.taMinText));if(isNaN(u))throw"Min text must be an integer";i.$observe("taMinText",function(n){if(u=parseInt(n),isNaN(u))throw"Min text must be an integer";r.$dirty&&r.$validate()});r.$validators.taMinText=function(n){var t=angular.element("<div/>");return t.html(n),!t.text().length||t.text().length>=u}}}});angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){var n=/<(a|abbr|acronym|bdi|bdo|big|cite|code|del|dfn|img|ins|kbd|label|map|mark|q|ruby|rp|rt|s|samp|time|tt|var)[^>]*(>|$)/i;return function(t){return function(i){if(!i)return!0;var u=/(^[^<]|>)[^<]/i.exec(i),r;return(u?r=u.index:(i=i.toString().replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,""),r=i.indexOf(">")),i=i.trim().substring(r,r+100),/^[^<>]+$/i.test(i))?!1:i.length===0||i===t||/^>(\s|&nbsp;)*<\/[^>]+>$/ig.test(i)?!0:/>\s*[^\s<]/i.test(i)||n.test(i)?!1:!0}}}]).directive("taButton",[function(){return{link:function(n,t){t.attr("unselectable","on");t.on("mousedown",function(n,t){return t&&angular.extend(n,t),n.preventDefault(),!1})}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM","textAngularManager",function(i,r,u,f,l,a,v,y,p,w,b,k,d,g){return{priority:2,require:["ngModel","?ngModelOptions"],link:function(a,nt,tt,it){function nr(n){var t;return gi.forEach(function(i){if(i.keyCode===n.keyCode){var r=(n.metaKey?ht:0)+(n.ctrlKey?st:0)+(n.shiftKey?lt:0)+(n.altKey?ct:0);if(i.forbiddenModifiers&r)return;i.mustHaveModifiers.every(function(n){return r&n})&&(t=i.specialKey)}}),t}var rt=it[0],ii=it[1]||{},ft=nt.attr("contenteditable")!==undefined&&nt.attr("contenteditable"),ai=ft||nt[0].tagName.toLowerCase()==="textarea"||nt[0].tagName.toLowerCase()==="input",ut=!1,yt=!1,gt=!1,vi=tt.taUnsafeSanitizer||w.disableSanitizer,yi,ki=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,di=/^(8|13|32|46|59|61|107|109|173|186|187|188|189|190|191|192|219|220|221|222)$/i,ri,et,ui,st=1,ht=2,ct=4,lt=8,gi=[{specialKey:"UndoKey",forbiddenModifiers:ct+lt,mustHaveModifiers:[ht+st],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:ct,mustHaveModifiers:[ht+st,lt],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:ct+lt,mustHaveModifiers:[ht+st],keyCode:89},{specialKey:"TabKey",forbiddenModifiers:ht+lt+ct+st,mustHaveModifiers:[],keyCode:9},{specialKey:"ShiftTabKey",forbiddenModifiers:ht+ct+st,mustHaveModifiers:[lt],keyCode:9}],ni,fi,pt,ei,bt,si,hi,bi;tt.taDefaultWrap===undefined&&(tt.taDefaultWrap="p");tt.taDefaultWrap===""?(et="",ui=n.ie===undefined?"<div><br><\/div>":n.ie>=11?"<p><br><\/p>":n.ie<=8?"<P>&nbsp;<\/P>":"<p>&nbsp;<\/p>"):(et=n.ie===undefined||n.ie>=11?"<"+tt.taDefaultWrap+"><br><\/"+tt.taDefaultWrap+">":n.ie<=8?"<"+tt.taDefaultWrap.toUpperCase()+"><\/"+tt.taDefaultWrap.toUpperCase()+">":"<"+tt.taDefaultWrap+"><\/"+tt.taDefaultWrap+">",ui=n.ie===undefined||n.ie>=11?"<"+tt.taDefaultWrap+"><br><\/"+tt.taDefaultWrap+">":n.ie<=8?"<"+tt.taDefaultWrap.toUpperCase()+">&nbsp;<\/"+tt.taDefaultWrap.toUpperCase()+">":"<"+tt.taDefaultWrap+">&nbsp;<\/"+tt.taDefaultWrap+">");ii.$options||(ii.$options={});ni=b(ui);fi=function(n){var s,u,i,h,r,f,e,o;if(ni(n))return n;if(s=angular.element("<div>"+n+"<\/div>"),s.children().length===0)n="<"+tt.taDefaultWrap+">"+n+"<\/"+tt.taDefaultWrap+">";else{for(u=s[0].childNodes,h=!1,i=0;i<u.length;i++)if(h=u[i].nodeName.toLowerCase().match(t))break;if(h)for(n="",i=0;i<u.length;i++)r=u[i],f=r.nodeName.toLowerCase(),f==="#comment"?n+="<!--"+r.nodeValue+"-->":f==="#text"?(e=r.textContent,n+=e.trim()?"<"+tt.taDefaultWrap+">"+e+"<\/"+tt.taDefaultWrap+">":e):f.match(t)?n+=r.outerHTML:(o=r.outerHTML||r.nodeValue,n+=o.trim()!==""?"<"+tt.taDefaultWrap+">"+o+"<\/"+tt.taDefaultWrap+">":o);else n="<"+tt.taDefaultWrap+">"+n+"<\/"+tt.taDefaultWrap+">"}return n};tt.taPaste&&(ri=k(tt.taPaste));nt.addClass("ta-bind");a["$undoManager"+(tt.id||"")]=rt.$undoManager={_stack:[],_index:0,_max:1e3,push:function(n){return typeof n=="undefined"||n===null||typeof this.current()!="undefined"&&this.current()!==null&&n===this.current()?n:(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(n),pt&&r.cancel(pt),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1,n)},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(n){return n<0||n>this._stack.length-1?undefined:(this._index=n,this.current())},current:function(){return this._stack[this._index]}};var at,tr=a["$undoTaBind"+(tt.id||"")]=function(){if(!ut&&ft){var n=rt.$undoManager.undo();typeof n!="undefined"&&n!==null&&(ot(n),vt(n,!1),at&&r.cancel(at),at=r(function(){nt[0].focus();v.setSelectionToElementEnd(nt[0])},1))}},ir=a["$redoTaBind"+(tt.id||"")]=function(){if(!ut&&ft){var n=rt.$undoManager.redo();typeof n!="undefined"&&n!==null&&(ot(n),vt(n,!1),at&&r.cancel(at),at=r(function(){nt[0].focus();v.setSelectionToElementEnd(nt[0])},1))}},wt=function(){if(ft)return nt[0].innerHTML;if(ai)return nt.val();throw"textAngular Error: attempting to update non-editable taBind";},vt=function(n,t,i){gt=i||!1;(typeof t=="undefined"||t===null)&&(t=!0&&ft);(typeof n=="undefined"||n===null)&&(n=wt());ni(n)?(rt.$viewValue!==""&&rt.$setViewValue(""),t&&rt.$undoManager.current()!==""&&rt.$undoManager.push("")):(ci(),rt.$viewValue!==n&&(rt.$setViewValue(n),t&&rt.$undoManager.push(n)));rt.$render()};if(a["updateTaBind"+(tt.id||"")]=function(){ut||vt(undefined,undefined,!0)},ei=function(n){return rt.$oldViewValue=i(l(n),rt.$oldViewValue,vi)},nt.attr("required")&&(rt.$validators.required=function(n,t){return!ni(n||t)}),rt.$parsers.push(ei),rt.$parsers.unshift(fi),rt.$formatters.push(ei),rt.$formatters.unshift(fi),rt.$formatters.unshift(function(n){return rt.$undoManager.push(n||"")}),ai)if(a.events={},ft){bt=!1;si=function(n){var f,k,e,u,h,it,g,w,l,b,tt;if(n&&n.trim().length){if(n.match(/class=["']*Mso(Normal|List)/i)){f=n.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);f=f?f[1]:n;f=f.replace(/<o:p>[\s\S]*?<\/o:p>/ig,"").replace(/class=(["']|)MsoNormal(["']|)/ig,"");var y=angular.element("<div>"+f+"<\/div>"),s=angular.element("<div><\/div>"),t={element:null,lastIndent:[],lastLi:null,isUl:!1};for(t.lastIndent.peek=function(){var n=this.length;if(n>0)return this[n-1]},k=function(n){t.isUl=n;t.element=angular.element(n?"<ul>":"<ol>");t.lastIndent=[];t.lastIndent.peek=function(){var n=this.length;if(n>0)return this[n-1]};t.lastLevelMatch=null},e=0;e<=y[0].childNodes.length;e++)if(y[0].childNodes[e]&&y[0].childNodes[e].nodeName!=="#text"&&y[0].childNodes[e].tagName.toLowerCase()==="p")if(u=angular.element(y[0].childNodes[e]),h=(u.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i),h){if(u[0].childNodes.length<2||u[0].childNodes[1].childNodes.length<1)continue;var p=h[1].toLowerCase()==="bullet"||h[1].toLowerCase()!=="number"&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(u[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(u[0].childNodes[1].childNodes[0].innerHTML)),ut=(u.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),o=parseFloat(ut?ut[1]:0),c=(u.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(c&&c[2]&&(o=parseInt(c[2])),(!c||t.lastLevelMatch&&c[1]===t.lastLevelMatch[1])&&h[3]&&h[3].toLowerCase()!=="first"&&t.lastIndent.peek()!==null&&(t.isUl===p||t.lastIndent.peek()!==o)){if(t.lastIndent.peek()!=null&&t.lastIndent.peek()<o)t.element=angular.element(p?"<ul>":"<ol>"),t.lastLi.append(t.element);else if(t.lastIndent.peek()!=null&&t.lastIndent.peek()>o){while(t.lastIndent.peek()!=null&&t.lastIndent.peek()>o){if(t.element.parent()[0].tagName.toLowerCase()==="li"){t.element=t.element.parent();continue}else if(/[uo]l/i.test(t.element.parent()[0].tagName.toLowerCase()))t.element=t.element.parent();else break;t.lastIndent.pop()}t.isUl=t.element[0].tagName.toLowerCase()==="ul";p!==t.isUl&&(k(p),s.append(t.element))}}else k(p),s.append(t.element);t.lastLevelMatch=c;o!==t.lastIndent.peek()&&t.lastIndent.push(o);t.lastLi=angular.element("<li>");t.element.append(t.lastLi);t.lastLi.html(u.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/ig,""));u.remove()}else k(!1),s.append(u);it=function(n){n=angular.element(n);for(var t=n[0].childNodes.length-1;t>=0;t--)n.after(n[0].childNodes[t]);n.remove()};angular.forEach(s.find("span"),function(n){n.removeAttribute("lang");n.attributes.length<=0&&it(n)});angular.forEach(s.find("font"),it);n=s.html()}else{if(n=n.replace(/<(|\/)meta[^>]*?>/ig,""),n.match(/<[^>]*?(ta-bind)[^>]*?>/)){if(n.match(/<[^>]*?(text-angular)[^>]*?>/)){for(g=angular.element("<div>"+n+"<\/div>"),g.find("textarea").remove(),w=d.getByAttribute(g,"ta-bind"),l=0;l<w.length;l++){for(b=w[l][0].parentNode.parentNode,tt=0;tt<w[l][0].childNodes.length;tt++)b.parentNode.insertBefore(w[l][0].childNodes[tt],b);b.parentNode.removeChild(b)}n=g.html().replace('<br class="Apple-interchange-newline">',"")}}else n.match(/^<span/)&&(n.match(/<span class=(\"Apple-converted-space\"|\'Apple-converted-space\')>.<\/span>/ig)||(n=n.replace(/<(|\/)span[^>]*?>/ig,"")));n=n.replace(/<br class="Apple-interchange-newline"[^>]*?>/ig,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/ig,"&nbsp;")}/<li(\s.*)?>/i.test(n)&&/(<ul(\s.*)?>|<ol(\s.*)?>).*<li(\s.*)?>/i.test(n)===!1&&(n=n.replace(/<li(\s.*)?>.*<\/li(\s.*)?>/i,"<ul>$&<\/ul>"));n=n.replace(/^[ |\u00A0]+/gm,function(n){for(var t="",i=0;i<n.length;i++)t+="&nbsp;";return t}).replace(/\n|\r\n|\r/g,"<br />").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");ri&&(n=ri(a,{$html:n})||n);n=i(n,"",vi);v.insertHtml(n,nt[0]);r(function(){rt.$setViewValue(wt());bt=!1;nt.removeClass("processing-paste")},0)}else bt=!1,nt.removeClass("processing-paste")};nt.on("paste",a.events.paste=function(n,t){var h,i,o,s,c,e;if(t&&angular.extend(n,t),ut||bt)return n.stopPropagation(),n.preventDefault(),!1;if(bt=!0,nt.addClass("processing-paste"),i=(n.originalEvent||n).clipboardData,i&&i.getData&&i.types.length>0){for(o="",s=0;s<i.types.length;s++)o+=" "+i.types[s];return/text\/html/i.test(o)?h=i.getData("text/html"):/text\/plain/i.test(o)&&(h=i.getData("text/plain")),si(h),n.stopPropagation(),n.preventDefault(),!1}c=u.rangy.saveSelection();e=angular.element('<div class="ta-hidden-input" contenteditable="true"><\/div>');f.find("body").append(e);e[0].focus();r(function(){u.rangy.restoreSelection(c);si(e[0].innerHTML);nt[0].focus();e.remove()},0)});nt.on("cut",a.events.cut=function(n){ut?n.preventDefault():r(function(){rt.$setViewValue(wt())},0)});nt.on("keydown",a.events.keydown=function(n,t){var e,r,i,u,f;if(t&&angular.extend(n,t),n.specialKey=nr(n),w.keyMappings.forEach(function(t){n.specialKey===t.commandKeyCode&&(n.specialKey=undefined);t.testForKey(n)&&(e=t.commandKeyCode);(t.commandKeyCode==="UndoKey"||t.commandKeyCode==="RedoKey")&&(t.enablePropagation||n.preventDefault())}),typeof e!="undefined"&&(n.specialKey=e),typeof n.specialKey!="undefined"&&(n.specialKey!=="UndoKey"||n.specialKey!=="RedoKey")&&(n.preventDefault(),g.sendKeyCommand(a,n)),!ut&&(n.specialKey==="UndoKey"&&(tr(),n.preventDefault()),n.specialKey==="RedoKey"&&(ir(),n.preventDefault()),n.keyCode===13&&!n.shiftKey)){if(i=v.getSelectionElement(),!i.tagName.match(s))return;u=angular.element(et);/^<br(|\/)>$/i.test(i.innerHTML.trim())&&i.parentNode.tagName.toLowerCase()==="blockquote"&&!i.nextSibling?(r=angular.element(i),f=r.parent(),f.after(u),r.remove(),f.children().length===0&&f.remove(),v.setSelectionToElementStart(u[0]),n.preventDefault()):/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(i.innerHTML.trim())&&i.tagName.toLowerCase()==="blockquote"&&(r=angular.element(i),r.after(u),r.remove(),v.setSelectionToElementStart(u[0]),n.preventDefault())}});nt.on("keyup",a.events.keyup=function(n,t){var o,i,f,u,e;if(t&&angular.extend(n,t),n.keyCode===9){o=v.getSelection();o.start.element===nt[0]&&nt.children().length&&v.setSelectionToElementStart(nt.children()[0]);return}if(pt&&r.cancel(pt),!ut&&!ki.test(n.keyCode)){if(et!==""&&n.keyCode===13&&!n.shiftKey){for(i=v.getSelectionElement();!i.tagName.match(s)&&i!==nt[0];)i=i.parentNode;i.tagName.toLowerCase()!==tt.taDefaultWrap&&i.tagName.toLowerCase()!=="li"&&(i.innerHTML.trim()===""||i.innerHTML.trim()==="<br>")&&(f=angular.element(et),angular.element(i).replaceWith(f),v.setSelectionToElementStart(f[0]))}u=wt();et!==""&&u.trim()===""?(ot(et),v.setSelectionToElementStart(nt.children()[0])):u.substring(0,1)!=="<"&&tt.taDefaultWrap!=="";e=yi!==n.keyCode&&di.test(n.keyCode);hi&&r.cancel(hi);hi=r(function(){vt(u,e,!0)},ii.$options.debounce||400);e||(pt=r(function(){rt.$undoManager.push(u)},250));yi=n.keyCode}});nt.on("blur",a.events.blur=function(){yt=!1;ut?(gt=!0,rt.$render()):vt(undefined,undefined,!0)});if(tt.placeholder&&(n.ie>8||n.ie===undefined)){if(tt.id)bi=h("#"+tt.id+".placeholder-text:before",'content: "'+tt.placeholder+'"');else throw"textAngular Error: An unique ID is required for placeholders to work";a.$on("$destroy",function(){c(bi)})}nt.on("focus",a.events.focus=function(){yt=!0;nt.removeClass("placeholder-text");ci()});nt.on("mouseup",a.events.mouseup=function(){var n=v.getSelection();n.start.element===nt[0]&&nt.children().length&&v.setSelectionToElementStart(nt.children()[0])});nt.on("mousedown",a.events.mousedown=function(n,t){t&&angular.extend(n,t);n.stopPropagation()})}else{nt.on("change blur",a.events.change=a.events.blur=function(){ut||rt.$setViewValue(wt())});nt.on("keydown",a.events.keydown=function(n,t){var f,u;if(t&&angular.extend(n,t),n.keyCode===9){var r=this.selectionStart,e=this.selectionEnd,i=nt.val();n.shiftKey?(f=i.lastIndexOf("\n",r),u=i.lastIndexOf("\t",r),u!==-1&&u>=f&&(nt.val(i.substring(0,u)+i.substring(u+1)),this.selectionStart=this.selectionEnd=r-1)):(nt.val(i.substring(0,r)+"\t"+i.substring(e)),this.selectionStart=this.selectionEnd=r+1);n.preventDefault()}});var oi=function(n,t){for(var i="",r=0;r<t;r++)i+=n;return i},pi=function(n,t,i){for(var r=0;r<n.length;r++)t.call(i,r,n[r])},wi=function(n,t){var i="",r=n.childNodes;return t++,i+=oi("\t",t-1)+n.outerHTML.substring(0,4),pi(r,function(n,r){var u=r.nodeName.toLowerCase();if(u==="#comment"){i+="<!--"+r.nodeValue+"-->";return}if(u==="#text"){i+=r.textContent;return}r.outerHTML&&(i+=u==="ul"||u==="ol"?"\n"+wi(r,t):"\n"+oi("\t",t)+r.outerHTML)}),i+="\n"+oi("\t",t-1)+n.outerHTML.substring(n.outerHTML.lastIndexOf("<"))};rt.$formatters.unshift(function(n){var t=angular.element("<div>"+n+"<\/div>")[0].childNodes;return t.length>0&&(n="",pi(t,function(t,i){var r=i.nodeName.toLowerCase();if(r==="#comment"){n+="<!--"+i.nodeValue+"-->";return}if(r==="#text"){n+=i.textContent;return}i.outerHTML&&(n.length>0&&(n+="\n"),n+=r==="ul"||r==="ol"?""+wi(i,0):""+i.outerHTML)})),n})}var kt=function(n){return a.$emit("ta-element-select",this),n.preventDefault(),!1},dt=function(n,t){if(t&&angular.extend(n,t),!e&&!ut){e=!0;var i;i=n.originalEvent?n.originalEvent.dataTransfer:n.dataTransfer;a.$emit("ta-drop-event",this,n,i);r(function(){e=!1;vt(undefined,undefined,!0)},100)}},ci=a["reApplyOnSelectorHandlers"+(tt.id||"")]=function(){ut||angular.forEach(y,function(n){nt.find(n).off("click",kt).on("click",kt)})},ot=function(n){nt[0].innerHTML=n},ti,li=!1;if(rt.$render=function(){if(!li){li=!0;var n=rt.$viewValue||"";if(!gt)if(ft&&yt&&(nt.removeClass("placeholder-text"),ti&&r.cancel(ti),ti=r(function(){yt||(nt[0].focus(),v.setSelectionToElementEnd(nt.children()[nt.children().length-1]));ti=undefined},1)),ft)if(tt.placeholder?n===""?ot(et):ot(n):ot(n===""?et:n),ut)nt.off("drop",dt);else{ci();nt.on("drop",dt)}else nt[0].tagName.toLowerCase()!=="textarea"&&nt[0].tagName.toLowerCase()!=="input"?ot(p(n)):nt.val(n);ft&&tt.placeholder&&(n===""?yt?nt.removeClass("placeholder-text"):nt.addClass("placeholder-text"):nt.removeClass("placeholder-text"));li=gt=!1}},tt.taReadonly&&(ut=a.$eval(tt.taReadonly),ut?(nt.addClass("ta-readonly"),(nt[0].tagName.toLowerCase()==="textarea"||nt[0].tagName.toLowerCase()==="input")&&nt.attr("disabled","disabled"),nt.attr("contenteditable")!==undefined&&nt.attr("contenteditable")&&nt.removeAttr("contenteditable")):(nt.removeClass("ta-readonly"),nt[0].tagName.toLowerCase()==="textarea"||nt[0].tagName.toLowerCase()==="input"?nt.removeAttr("disabled"):ft&&nt.attr("contenteditable","true")),a.$watch(tt.taReadonly,function(n,t){if(t!==n){if(n)nt.addClass("ta-readonly"),(nt[0].tagName.toLowerCase()==="textarea"||nt[0].tagName.toLowerCase()==="input")&&nt.attr("disabled","disabled"),nt.attr("contenteditable")!==undefined&&nt.attr("contenteditable")&&nt.removeAttr("contenteditable"),angular.forEach(y,function(n){nt.find(n).on("click",kt)}),nt.off("drop",dt);else{nt.removeClass("ta-readonly");nt[0].tagName.toLowerCase()==="textarea"||nt[0].tagName.toLowerCase()==="input"?nt.removeAttr("disabled"):ft&&nt.attr("contenteditable","true");angular.forEach(y,function(n){nt.find(n).off("click",kt)});nt.on("drop",dt)}ut=n}})),ft&&!ut){angular.forEach(y,function(n){nt.find(n).on("click",kt)});nt.on("drop",dt);nt.on("blur",function(){n.webkit&&(o=!0)})}}}}]);e=!1;f=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]);f.config([function(){angular.forEach(taTools,function(n,t){delete taTools[t]})}]);f.run([function(){if(typeof define=="function"&&define.amd)define(function(n){window.rangy=n("rangy");window.rangy.saveSelection=n("rangy/lib/rangy-selectionsaverestore")});else if(typeof require=="function"&&typeof module!="undefined"&&typeof exports=="object")window.rangy=require("rangy"),window.rangy.saveSelection=require("rangy/lib/rangy-selectionsaverestore");else if(window.rangy){if(window.rangy.init(),!window.rangy.saveSelection)throw"rangy-selectionsaverestore.js is required for textAngular to work correctly.";}else throw"rangy-core.js and rangy-selectionsaverestore.js are required for textAngular to work correctly, rangy-core is not yet loaded.";}]);f.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log","$q","$parse",function(n,t,i,r,u,f,e,o,s,h,c,l){return{require:"?ngModel",scope:{},restrict:"EA",priority:2,link:function(a,v,y,p){var tt,it,rt,ut,ft,et,g,k,w=y.serial?y.serial:Math.floor(Math.random()*10000000000000000),ct,ot,st,nt,d,ht,b;if(a._name=y.name?y.name:"textAngularEditor"+w,nt=function(n,i,r){t(function(){var t=function(){n.off(i,t);r.apply(this,arguments)};n.on(i,t)},100)},ct=u(y.taDefaultWrap),angular.extend(a,angular.copy(i),{wrapSelection:function(n,t,i){n.toLowerCase()==="undo"?a["$undoTaBindtaTextElement"+w]():n.toLowerCase()==="redo"?a["$redoTaBindtaTextElement"+w]():(ct(n,!1,t,a.defaultTagAttributes),i&&a["reApplyOnSelectorHandlerstaTextElement"+w](),a.displayElements.text[0].focus())},showHtml:a.$eval(y.taShowHtml)||!1}),y.taFocussedClass&&(a.classes.focussed=y.taFocussedClass),y.taTextEditorClass&&(a.classes.textEditor=y.taTextEditorClass),y.taHtmlEditorClass&&(a.classes.htmlEditor=y.taHtmlEditorClass),y.taDefaultTagAttributes)try{angular.extend(a.defaultTagAttributes,angular.fromJson(y.taDefaultTagAttributes))}catch(lt){h.error(lt)}y.taTextEditorSetup&&(a.setup.textEditorSetup=a.$parent.$eval(y.taTextEditorSetup));y.taHtmlEditorSetup&&(a.setup.htmlEditorSetup=a.$parent.$eval(y.taHtmlEditorSetup));a.fileDropHandler=y.taFileDrop?a.$parent.$eval(y.taFileDrop):a.defaultFileDropHandler;g=v[0].innerHTML;v[0].innerHTML="";a.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea><\/textarea>"),text:angular.element("<div><\/div>"),scrollWindow:angular.element("<div class='ta-scroll-window'><\/div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"><\/div>'),popoverArrow:angular.element('<div class="arrow"><\/div>'),popoverContainer:angular.element('<div class="popover-content"><\/div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"><\/div>'),background:angular.element('<div class="ta-resizer-handle-background"><\/div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"><\/div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"><\/div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"><\/div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"><\/div>')],info:angular.element('<div class="ta-resizer-handle-info"><\/div>')}};a.displayElements.popover.append(a.displayElements.popoverArrow);a.displayElements.popover.append(a.displayElements.popoverContainer);a.displayElements.scrollWindow.append(a.displayElements.popover);a.displayElements.popover.on("mousedown",function(n,t){return t&&angular.extend(n,t),n.preventDefault(),!1});a.showPopover=function(n){a.displayElements.popover.css("display","block");a.reflowPopover(n);s.addClass(a.displayElements.popover,"in");nt(o.find("body"),"click keyup",function(){a.hidePopover()})};a.reflowPopover=function(n){a.displayElements.text[0].offsetHeight-51>n[0].offsetTop?(a.displayElements.popover.css("top",n[0].offsetTop+n[0].offsetHeight+a.displayElements.scrollWindow[0].scrollTop+"px"),a.displayElements.popover.removeClass("top").addClass("bottom")):(a.displayElements.popover.css("top",n[0].offsetTop-54+a.displayElements.scrollWindow[0].scrollTop+"px"),a.displayElements.popover.removeClass("bottom").addClass("top"));var i=a.displayElements.text[0].offsetWidth-a.displayElements.popover[0].offsetWidth,t=n[0].offsetLeft+n[0].offsetWidth/2-a.displayElements.popover[0].offsetWidth/2;a.displayElements.popover.css("left",Math.max(0,Math.min(i,t))+"px");a.displayElements.popoverArrow.css("margin-left",Math.min(t,Math.max(0,t-i))-11+"px")};a.hidePopover=function(){a.displayElements.popover.css("display","");a.displayElements.popoverContainer.attr("style","");a.displayElements.popoverContainer.attr("class","popover-content");a.displayElements.popover.removeClass("in")};a.displayElements.resize.overlay.append(a.displayElements.resize.background);angular.forEach(a.displayElements.resize.anchors,function(n){a.displayElements.resize.overlay.append(n)});a.displayElements.resize.overlay.append(a.displayElements.resize.info);a.displayElements.scrollWindow.append(a.displayElements.resize.overlay);a.reflowResizeOverlay=function(n){n=angular.element(n)[0];a.displayElements.resize.overlay.css({display:"block",left:n.offsetLeft-5+"px",top:n.offsetTop-5+"px",width:n.offsetWidth+10+"px",height:n.offsetHeight+10+"px"});a.displayElements.resize.info.text(n.offsetWidth+" x "+n.offsetHeight)};a.showResizeOverlay=function(n){var t=o.find("body");ot=function(i){var r={width:parseInt(n.attr("width")),height:parseInt(n.attr("height")),x:i.clientX,y:i.clientY},u,f;(r.width===undefined||isNaN(r.width))&&(r.width=n[0].offsetWidth);(r.height===undefined||isNaN(r.height))&&(r.height=n[0].offsetHeight);a.hidePopover();u=r.height/r.width;f=function(t){function o(n){return Math.round(Math.max(0,n))}var i={x:Math.max(0,r.width+(t.clientX-r.x)),y:Math.max(0,r.height+(t.clientY-r.y))},s=y.taResizeForceAspectRatio!==undefined,h=y.taResizeMaintainAspectRatio,c=s||h&&!t.shiftKey,f,e;c&&(f=i.y/i.x,i.x=u>f?i.x:i.y/u,i.y=u>f?i.x*u:i.y);e=angular.element(n);e.css("height",o(i.y)+"px");e.css("width",o(i.x)+"px");a.reflowResizeOverlay(n)};t.on("mousemove",f);nt(t,"mouseup",function(i){i.preventDefault();i.stopPropagation();t.off("mousemove",f);a.showPopover(n)});i.stopPropagation();i.preventDefault()};a.displayElements.resize.anchors[3].off("mousedown");a.displayElements.resize.anchors[3].on("mousedown",ot);a.reflowResizeOverlay(n);nt(t,"click",function(){a.hideResizeOverlay()})};a.hideResizeOverlay=function(){a.displayElements.resize.anchors[3].off("mousedown",ot);a.displayElements.resize.overlay.css("display","")};a.setup.htmlEditorSetup(a.displayElements.html);a.setup.textEditorSetup(a.displayElements.text);a.displayElements.html.attr({id:"taHtmlElement"+w,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html","ng-model-options":v.attr("ng-model-options")});a.displayElements.text.attr({id:"taTextElement"+w,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html","ng-model-options":v.attr("ng-model-options")});a.displayElements.scrollWindow.attr({"ng-hide":"showHtml"});y.taDefaultWrap&&a.displayElements.text.attr("ta-default-wrap",y.taDefaultWrap);y.taUnsafeSanitizer&&(a.displayElements.text.attr("ta-unsafe-sanitizer",y.taUnsafeSanitizer),a.displayElements.html.attr("ta-unsafe-sanitizer",y.taUnsafeSanitizer));a.displayElements.scrollWindow.append(a.displayElements.text);v.append(a.displayElements.scrollWindow);v.append(a.displayElements.html);a.displayElements.forminput.attr("name",a._name);v.append(a.displayElements.forminput);y.tabindex&&(v.removeAttr("tabindex"),a.displayElements.text.attr("tabindex",y.tabindex),a.displayElements.html.attr("tabindex",y.tabindex));y.placeholder&&(a.displayElements.text.attr("placeholder",y.placeholder),a.displayElements.html.attr("placeholder",y.placeholder));y.taDisabled&&(a.displayElements.text.attr("ta-readonly","disabled"),a.displayElements.html.attr("ta-readonly","disabled"),a.disabled=a.$parent.$eval(y.taDisabled),a.$parent.$watch(y.taDisabled,function(n){a.disabled=n;a.disabled?v.addClass(a.classes.disabled):v.removeClass(a.classes.disabled)}));y.taPaste&&(a._pasteHandler=function(n){return l(y.taPaste)(a.$parent,{$html:n})},a.displayElements.text.attr("ta-paste","_pasteHandler($html)"));n(a.displayElements.scrollWindow)(a);n(a.displayElements.html)(a);a.updateTaBindtaTextElement=a["updateTaBindtaTextElement"+w];a.updateTaBindtaHtmlElement=a["updateTaBindtaHtmlElement"+w];v.addClass("ta-root");a.displayElements.scrollWindow.addClass("ta-text ta-editor "+a.classes.textEditor);a.displayElements.html.addClass("ta-html ta-editor "+a.classes.htmlEditor);a._actionRunning=!1;d=!1;a.startAction=function(){return a._actionRunning=!0,d=e.rangy.saveSelection(),function(){d&&e.rangy.restoreSelection(d)}};a.endAction=function(){a._actionRunning=!1;d&&(a.showHtml?a.displayElements.html[0].focus():a.displayElements.text[0].focus(),e.rangy.removeMarkers(d));d=!1;a.updateSelectedStyles();a.showHtml||a["updateTaBindtaTextElement"+w]()};ft=function(){a.focussed=!0;v.addClass(a.classes.focussed);k.focus();v.triggerHandler("focus")};a.displayElements.html.on("focus",ft);a.displayElements.text.on("focus",ft);et=function(n){return a._actionRunning||o[0].activeElement===a.displayElements.html[0]||o[0].activeElement===a.displayElements.text[0]||(v.removeClass(a.classes.focussed),k.unfocus(),t(function(){a._bUpdateSelectedStyles=!1;v.triggerHandler("blur");a.focussed=!1},0)),n.preventDefault(),!1};a.displayElements.html.on("blur",et);a.displayElements.text.on("blur",et);a.displayElements.text.on("paste",function(n){v.triggerHandler("paste",n)});a.queryFormatBlockState=function(n){return!a.showHtml&&n.toLowerCase()===o[0].queryCommandValue("formatBlock").toLowerCase()};a.queryCommandState=function(n){return a.showHtml?"":o[0].queryCommandState(n)};a.switchView=function(){a.showHtml=!a.showHtml;s.enabled(!1,a.displayElements.html);s.enabled(!1,a.displayElements.text);a.showHtml?t(function(){return s.enabled(!0,a.displayElements.html),s.enabled(!0,a.displayElements.text),a.displayElements.html[0].focus()},100):t(function(){return s.enabled(!0,a.displayElements.html),s.enabled(!0,a.displayElements.text),a.displayElements.text[0].focus()},100)};y.ngModel?(ht=!0,p.$render=function(){if(ht){ht=!1;var n=a.$parent.$eval(y.ngModel);(n===undefined||n===null)&&g&&g!==""&&p.$setViewValue(g)}a.displayElements.forminput.val(p.$viewValue);a.html=p.$viewValue||""},v.attr("required")&&(p.$validators.required=function(n,t){var i=n||t;return!(!i||i.trim()==="")})):(a.displayElements.forminput.val(g),a.html=g);a.$watch("html",function(n,t){n!==t&&(y.ngModel&&p.$viewValue!==n&&p.$setViewValue(n),a.displayElements.forminput.val(n))});y.taTargetToolbars?k=f.registerEditor(a._name,a,y.taTargetToolbars.split(",")):(b=angular.element('<div text-angular-toolbar name="textAngularToolbar'+w+'">'),y.taToolbar&&b.attr("ta-toolbar",y.taToolbar),y.taToolbarClass&&b.attr("ta-toolbar-class",y.taToolbarClass),y.taToolbarGroupClass&&b.attr("ta-toolbar-group-class",y.taToolbarGroupClass),y.taToolbarButtonClass&&b.attr("ta-toolbar-button-class",y.taToolbarButtonClass),y.taToolbarActiveButtonClass&&b.attr("ta-toolbar-active-button-class",y.taToolbarActiveButtonClass),y.taFocussedClass&&b.attr("ta-focussed-class",y.taFocussedClass),v.prepend(b),n(b)(a.$parent),k=f.registerEditor(a._name,a,["textAngularToolbar"+w]));a.$on("$destroy",function(){f.unregisterEditor(a._name);angular.element(window).off("blur")});a.$on("ta-element-select",function(n,t){k.triggerElementSelect(n,t)&&a["reApplyOnSelectorHandlerstaTextElement"+w]()});a.$on("ta-drop-event",function(n,i,r,u){a.displayElements.text[0].focus();u&&u.files&&u.files.length>0?(angular.forEach(u.files,function(n){try{c.when(a.fileDropHandler(n,a.wrapSelection)||a.fileDropHandler!==a.defaultFileDropHandler&&c.when(a.defaultFileDropHandler(n,a.wrapSelection))).then(function(){a["updateTaBindtaTextElement"+w]()})}catch(t){h.error(t)}}),r.preventDefault(),r.stopPropagation()):t(function(){a["updateTaBindtaTextElement"+w]()},0)});a._bUpdateSelectedStyles=!1;angular.element(window).on("blur",function(){a._bUpdateSelectedStyles=!1;a.focussed=!1});a.updateSelectedStyles=function(){var n;st&&t.cancel(st);(n=r.getSelectionElement())!==undefined&&n.parentNode!==a.displayElements.text[0]?k.updateSelectedStyles(angular.element(n)):k.updateSelectedStyles();a._bUpdateSelectedStyles&&(st=t(a.updateSelectedStyles,200))};tt=function(){if(!a.focussed){a._bUpdateSelectedStyles=!1;return}a._bUpdateSelectedStyles||(a._bUpdateSelectedStyles=!0,a.$apply(function(){a.updateSelectedStyles()}))};a.displayElements.html.on("keydown",tt);a.displayElements.text.on("keydown",tt);it=function(){a._bUpdateSelectedStyles=!1};a.displayElements.html.on("keyup",it);a.displayElements.text.on("keyup",it);rt=function(n,t){t&&angular.extend(n,t);a.$apply(function(){if(k.sendKeyCommand(n))return a._bUpdateSelectedStyles||a.updateSelectedStyles(),n.preventDefault(),!1})};a.displayElements.html.on("keypress",rt);a.displayElements.text.on("keypress",rt);ut=function(){a._bUpdateSelectedStyles=!1;a.$apply(function(){a.updateSelectedStyles()})};a.displayElements.html.on("mouseup",ut);a.displayElements.text.on("mouseup",ut)}}}]);f.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(n,t,i){var r={},u={};return{registerEditor:function(i,f,e){if(!i||i==="")throw"textAngular Error: An editor requires a name";if(!f)throw"textAngular Error: An editor requires a scope";if(u[i])throw'textAngular Error: An Editor with name "'+i+'" already exists';var o=[];return angular.forEach(e,function(n){r[n]&&o.push(r[n])}),u[i]={scope:f,toolbars:e,_registerToolbar:function(n){this.toolbars.indexOf(n.name)>=0&&o.push(n)},editorFunctions:{disable:function(){angular.forEach(o,function(n){n.disabled=!0})},enable:function(){angular.forEach(o,function(n){n.disabled=!1})},focus:function(){angular.forEach(o,function(n){n._parent=f;n.disabled=!1;n.focussed=!0;f.focussed=!0})},unfocus:function(){angular.forEach(o,function(n){n.disabled=!0;n.focussed=!1});f.focussed=!1},updateSelectedStyles:function(n){angular.forEach(o,function(t){angular.forEach(t.tools,function(i){i.activeState&&(t._parent=f,i.active=i.activeState(n))})})},sendKeyCommand:function(i){var r=!1;return(i.ctrlKey||i.metaKey||i.specialKey)&&angular.forEach(t,function(t,u){if(t.commandKeyCode&&(t.commandKeyCode===i.which||t.commandKeyCode===i.specialKey))for(var e=0;e<o.length;e++)if(o[e].tools[u]!==undefined){n.call(o[e].tools[u],f);r=!0;break}}),r},triggerElementSelect:function(n,i){var h=function(n,t){for(var i=!0,r=0;r<t.length;r++)i=i&&n.attr(t[r]);return i},r=[],c={},l=!1,s,u,v,a,e;if(i=angular.element(i),s=!1,angular.forEach(t,function(n,t){n.onElementSelect&&n.onElementSelect.element&&n.onElementSelect.element.toLowerCase()===i[0].tagName.toLowerCase()&&(!n.onElementSelect.filter||n.onElementSelect.filter(i))&&(s=s||angular.isArray(n.onElementSelect.onlyWithAttrs)&&h(i,n.onElementSelect.onlyWithAttrs),(!n.onElementSelect.onlyWithAttrs||h(i,n.onElementSelect.onlyWithAttrs))&&(c[t]=n))}),s?(angular.forEach(c,function(n,t){n.onElementSelect.onlyWithAttrs&&h(i,n.onElementSelect.onlyWithAttrs)&&r.push({name:t,tool:n})}),r.sort(function(n,t){return t.tool.onElementSelect.onlyWithAttrs.length-n.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(c,function(n,t){r.push({name:t,tool:n})}),r.length>0)for(u=0;u<r.length;u++){for(v=r[u].tool,a=r[u].name,e=0;e<o.length;e++)if(o[e].tools[a]!==undefined){v.onElementSelect.action.call(o[e].tools[a],n,i,f);l=!0;break}if(l)break}return l}}},u[i].editorFunctions},retrieveEditor:function(n){return u[n]},unregisterEditor:function(n){delete u[n]},registerToolbar:function(n){if(!n)throw"textAngular Error: A toolbar requires a scope";if(!n.name||n.name==="")throw"textAngular Error: A toolbar requires a name";if(r[n.name])throw'textAngular Error: A toolbar with name "'+n.name+'" already exists';r[n.name]=n;angular.forEach(u,function(t){t._registerToolbar(n)})},retrieveToolbar:function(n){return r[n]},retrieveToolbarsViaEditor:function(n){var t=[],i=this;return angular.forEach(this.retrieveEditor(n).toolbars,function(n){t.push(i.retrieveToolbar(n))}),t},unregisterToolbar:function(n){delete r[n]},updateToolsDisplay:function(n){var t=this;angular.forEach(n,function(n,i){t.updateToolDisplay(i,n)})},resetToolsDisplay:function(){var n=this;angular.forEach(t,function(t,i){n.resetToolDisplay(i)})},updateToolDisplay:function(n,t){var i=this;angular.forEach(r,function(r,u){i.updateToolbarToolDisplay(u,n,t)})},resetToolDisplay:function(n){var t=this;angular.forEach(r,function(i,r){t.resetToolbarToolDisplay(r,n)})},updateToolbarToolDisplay:function(n,t,i){if(r[n])r[n].updateToolDisplay(t,i);else throw'textAngular Error: No Toolbar with name "'+n+'" exists';},resetToolbarToolDisplay:function(n,i){if(r[n])r[n].updateToolDisplay(i,t[i],!0);else throw'textAngular Error: No Toolbar with name "'+n+'" exists';},removeTool:function(n){delete t[n];angular.forEach(r,function(t){var r,i,u;for(delete t.tools[n],r=0;r<t.toolbar.length;r++){for(u=0;u<t.toolbar[r].length;u++){if(t.toolbar[r][u]===n){i={group:r,index:u};break}if(i!==undefined)break}i!==undefined&&(t.toolbar[i.group].slice(i.index,1),t._$element.children().eq(i.group).children().eq(i.index).remove())}})},addTool:function(n,t,u,f){i(n,t);angular.forEach(r,function(i){i.addTool(n,t,u,f)})},addToolToToolbar:function(n,t,u,f,e){i(n,t);r[u].addTool(n,t,f,e)},refreshEditor:function(n){if(u[n])u[n].scope.updateTaBindtaTextElement(),u[n].scope.$$phase||u[n].scope.$digest();else throw'textAngular Error: No Editor with name "'+n+'" exists';},sendKeyCommand:function(n,t){angular.forEach(u,function(i){if(i.editorFunctions.sendKeyCommand(t))return n._bUpdateSelectedStyles||n.updateSelectedStyles(),t.preventDefault(),!1})}}}]);f.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(n,t,i,r,u,f){return{scope:{name:"@"},restrict:"EA",link:function(e,o,s){var h,c;if(!e.name||e.name==="")throw"textAngular Error: A toolbar requires a name";angular.extend(e,angular.copy(i));s.taToolbar&&(e.toolbar=e.$parent.$eval(s.taToolbar));s.taToolbarClass&&(e.classes.toolbar=s.taToolbarClass);s.taToolbarGroupClass&&(e.classes.toolbarGroup=s.taToolbarGroupClass);s.taToolbarButtonClass&&(e.classes.toolbarButton=s.taToolbarButtonClass);s.taToolbarActiveButtonClass&&(e.classes.toolbarButtonActive=s.taToolbarActiveButtonClass);s.taFocussedClass&&(e.classes.focussed=s.taFocussedClass);e.disabled=!0;e.focussed=!1;e._$element=o;o[0].innerHTML="";o.addClass("ta-toolbar "+e.classes.toolbar);e.$watch("focussed",function(){e.focussed?o.addClass(e.classes.focussed):o.removeClass(e.classes.focussed)});h=function(t,i){var r,f,u;return r=t&&t.display?angular.element(t.display):angular.element("<button type='button'>"),t&&t["class"]?r.addClass(t["class"]):r.addClass(e.classes.toolbarButton),r.attr("name",i.name),r.attr("ta-button","ta-button"),r.attr("ng-disabled","isDisabled()"),r.attr("tabindex","-1"),r.attr("ng-click","executeAction()"),r.attr("ng-class","displayActiveToolClass(active)"),t&&t.tooltiptext&&r.attr("title",t.tooltiptext),!t||t.display||i._display||(r[0].innerHTML="",t.buttontext&&(r[0].innerHTML=t.buttontext),t.iconclass&&(f=angular.element("<i>"),u=r[0].innerHTML,f.addClass(t.iconclass),r[0].innerHTML="",r.append(f),u&&u!==""&&r.append("&nbsp;"+u))),i._lastToolDefinition=angular.copy(t),n(r)(i)};e.tools={};e._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};c={$window:f,$editor:function(){return e._parent},isDisabled:function(){return typeof this.$eval("disabled")!="function"&&this.$eval("disabled")||this.$eval("disabled()")||this.name!=="html"&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(n){return n?e.classes.toolbarButtonActive:""},executeAction:u};angular.forEach(e.toolbar,function(n){var t=angular.element("<div>");t.addClass(e.classes.toolbarGroup);angular.forEach(n,function(n){e.tools[n]=angular.extend(e.$new(!0),r[n],c,{name:n});e.tools[n].$element=h(r[n],e.tools[n]);t.append(e.tools[n].$element)});o.append(t)});e.updateToolDisplay=function(n,t,i){var r=e.tools[n],u;if(r){if(r._lastToolDefinition&&!i&&(t=angular.extend({},r._lastToolDefinition,t)),t.buttontext===null&&t.iconclass===null&&t.display===null)throw'textAngular Error: Tool Definition for updating "'+n+'" does not have a valid display/iconclass/buttontext value';t.buttontext===null&&delete t.buttontext;t.iconclass===null&&delete t.iconclass;t.display===null&&delete t.display;u=h(t,r);r.$element.replaceWith(u);r.$element=u}};e.addTool=function(n,t,i,u){e.tools[n]=angular.extend(e.$new(!0),r[n],c,{name:n});e.tools[n].$element=h(r[n],e.tools[n]);var f;i===undefined&&(i=e.toolbar.length-1);f=angular.element(o.children()[i]);u===undefined?(f.append(e.tools[n].$element),e.toolbar[i][e.toolbar[i].length-1]=n):(f.children().eq(u).after(e.tools[n].$element),e.toolbar[i][u]=n)};t.registerToolbar(e);e.$on("$destroy",function(){t.unregisterToolbar(e.name)})}}}])}();