(function(n,t){typeof define=="function"&&define.amd?define(["./rangy-core"],n):typeof module!="undefined"&&typeof exports=="object"?module.exports=n(require("rangy")):n(t.rangy)})(function(n){return n.createModule("TextRange",["WrappedSelection"],function(n,t){function nr(n,t){function e(n,t,i){o.push({start:n,end:t,isWord:i})}for(var s=n.join(""),f,o=[],i=0,r,u;f=t.wordRegex.exec(s);){if(r=f.index,u=r+f[0].length,r>i&&e(i,r,!1),t.includeTrailingSpace)while(di.test(n[u]))++u;e(r,u,!0);i=u}return i<n.length&&e(i,n.length,!1),o}function tr(n,t){for(var i=n.slice(t.start,t.end),u={isWord:t.isWord,chars:i,toString:function(){return i.join("")}},r=0,f=i.length;r<f;++r)i[r].token=u;return u}function it(n,t,i){for(var f=i(n,t),r=[],e=0,u;u=f[e++];)r.push(tr(n,u));return r}function ir(n){var t=n||"",i=typeof t=="string"?t.split(""):t;return i.sort(function(n,t){return n.charCodeAt(0)-t.charCodeAt(0)}),i.join("").replace(/(.)\1+/g,"$1")}function sr(n){var i,t;return n?(i=n.language||nt,t={},f(t,rt[i]||rt[nt]),f(t,n),t):rt[nt]}function w(n,t){var i=a(n,t);return t.hasOwnProperty("wordOptions")&&(i.wordOptions=sr(i.wordOptions)),t.hasOwnProperty("characterOptions")&&(i.characterOptions=a(i.characterOptions,p)),i}function b(n,t){var i=o(n,"display",t),r=n.tagName.toLowerCase();return i=="block"&&bt&&ut.hasOwnProperty(r)?ut[r]:i}function kt(n){for(var i=yr(n),t=0,r=i.length;t<r;++t)if(i[t].nodeType==1&&b(i[t])=="none")return!0;return!1}function hr(n){var t;return n.nodeType==3&&(t=n.parentNode)&&o(t,"visibility")=="hidden"}function cr(n){return n&&(n.nodeType==1&&!/^(inline(-block|-table)?|none)$/.test(b(n))||n.nodeType==9||n.nodeType==11)}function ar(n){return u.isCharacterDataNode(n)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(n.nodeName)}function vr(n){for(var t=[];n.parentNode;)t.unshift(n.parentNode),n=n.parentNode;return t}function yr(n){return vr(n).concat([n])}function pr(n){while(n&&!n.nextSibling)n=n.parentNode;return n?n.nextSibling:null}function dt(n,t){return!t&&n.hasChildNodes()?n.firstChild:pr(n)}function gt(n){var i=n.previousSibling,t;if(i){for(n=i;n.hasChildNodes();)n=n.lastChild;return n}return(t=n.parentNode,t&&t.nodeType==1)?t:null}function ni(n){var t,i,r;return!n||n.nodeType!=3?!1:(t=n.data,t==="")?!0:(i=n.parentNode,!i||i.nodeType!=1)?!1:(r=o(n.parentNode,"whiteSpace"),/^[\t\n\r ]+$/.test(t)&&/^(normal|nowrap)$/.test(r)||/^[\t\r ]+$/.test(t)&&r=="pre-line")}function ft(n){if(n.data==="")return!0;if(!ni(n))return!1;var t=n.parentNode;return t?kt(n)?!0:!1:!0}function s(n){var t=n.nodeType;return t==7||t==8||kt(n)||/^(script|style)$/i.test(n.nodeName)||hr(n)||ft(n)}function ti(n,t){var i=n.nodeType;return i==7||i==8||i==1&&b(n,t)=="none"}function h(){this.store={}}function i(n,t,i){return function(r){var u=this.cache,f;return u.hasOwnProperty(n)?(ii++,u[n]):(ri++,f=t.call(this,i?this[i]:this,r),u[n]=f,f)}}function ui(n,t){this.node=n;this.session=t;this.cache=new h;this.positions=new h}function ai(n,t){this.offset=t;this.nodeWrapper=n;this.node=n.node;this.session=n.session;this.cache=new h}function br(){return"[Position("+u.inspectNode(this.node)+":"+this.offset+")]"}function kr(){return ct(),e=new vi}function ht(){return e||kr()}function ct(){e&&e.detach();e=null}function l(n,i,r,u){function c(){var n=null;return i?(n=f,e||(f=f.previousVisible(),e=!f||r&&f.equals(r))):e||(n=f=f.nextVisible(),e=!f||r&&f.equals(r)),e&&(f=null),n}var f,e,h,o;return r&&(i?s(r.node)&&(r=n.previousVisible()):s(r.node)&&(r=r.nextVisible())),f=n,e=!1,o=!1,{next:function(){if(o)return o=!1,h;for(var n,t;n=c();)if(t=n.getCharacter(u),t)return h=n,n;return null},rewind:function(){if(h)o=!0;else throw t.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");},dispose:function(){n=r=null}}}function k(n,t,i){function f(n){for(var t,r,u=[],f=n?c:a,e=!1,i=!1;t=f.next();){if(r=t.character,yt.test(r))i&&(i=!1,e=!0);else if(e){f.rewind();break}else i=!0;u.push(t)}return u}var c=l(n,!1,null,t),a=l(n,!0,null,t),o=i.tokenizer,s=f(!0),h=f(!1).reverse(),e=it(h.concat(s),i,o),r=s.length?e.slice(lt(e,s[0].token)):[],u=h.length?e.slice(0,lt(e,h.pop().token)+1):[];return{nextEndToken:function(){for(var n,t;r.length==1&&!(n=r[0]).isWord&&(t=f(!0)).length>0;)r=it(n.chars.concat(t),i,o);return r.shift()},previousStartToken:function(){for(var n,t;u.length==1&&!(n=u[0]).isWord&&(t=f(!1)).length>0;)u=it(t.reverse().concat(n.chars),i,o);return u.pop()},dispose:function(){c.dispose();a.dispose();r=u=null}}}function dr(n,t,i,r,u){var e=0,a,f=n,o,c,p=Math.abs(i),s,h,y,w;if(i!==0){h=i<0;switch(t){case v:for(o=l(n,h,null,r);(a=o.next())&&e<p;)++e,f=a;c=a;o.dispose();break;case d:for(y=k(n,r,u),w=h?y.previousStartToken:y.nextEndToken;(s=w())&&e<p;)s.isWord&&(++e,f=h?s.chars[0]:s.chars[s.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+t+"' not implemented");}h?(f=f.previousVisible(),e=-e):f&&f.isLeadingSpace&&!f.isTrailingSpace&&(t==d&&(o=l(n,!1,null,r),c=o.next(),o.dispose()),c&&(f=c.previousVisible()))}return{position:f,unitsMoved:e}}function yi(n,t,i,r){var u=n.getRangeBoundaryPosition(t,!0),f=n.getRangeBoundaryPosition(t,!1),e=r?f:u,o=r?u:f;return l(e,!!r,o,i)}function gr(n,t,i){for(var r=[],u=yi(n,t,i),f;f=u.next();)r.push(f);return u.dispose(),r}function nu(t,i,r){var u=n.createRange(t.node);return u.setStartAndEnd(t.node,t.offset,i.node,i.offset),!u.expand("word",{wordOptions:r})}function tu(n,t,i,r,u){function w(n,t){var i=h[n].previousVisible(),r=h[t-1],f=!u.wholeWordsOnly||nu(i,r,u.wordOptions);return{startPos:i,endPos:r,valid:f}}for(var o=tt(u.direction),b=l(n,o,n.session.getRangeBoundaryPosition(r,o),u.characterOptions),e="",h=[],c,s,f,a,v,p,y=null;c=b.next();)if(s=c.character,i||u.caseSensitive||(s=s.toLowerCase()),o?(h.unshift(c),e=s+e):(h.push(c),e+=s),i){if(v=t.exec(e),v)if(f=v.index,a=f+v[0].length,p){if(!o&&a<e.length||o&&f>0){y=w(f,a);break}}else p=!0}else if((f=e.indexOf(t))!=-1){y=w(f,f+t.length);break}return p&&(y=w(f,a)),b.dispose(),y}function r(n){return function(){var t=!!e,i=ht(),r=[i].concat(y.toArray(arguments)),u=n.apply(this,r);return t||ct(),u}}function at(n,t){return r(function(i,r,u,f){var e,o,s;return typeof u==wi&&(u=r,r=v),f=w(f,fr),e=n,t&&(e=u>=0,this.collapse(!e)),o=dr(i.getRangeBoundaryPosition(this,e),r,u,f.characterOptions,f.wordOptions),s=o.position,this[e?"setStart":"setEnd"](s.node,s.offset),o.unitsMoved})}function pi(n){return r(function(t,i){var e,u,r,f;for(i=a(i,p),u=yi(t,this,i,!n),r=0;(e=u.next())&&yt.test(e.character);)++r;return u.dispose(),f=r>0,f&&this[n?"moveStart":"moveEnd"]("character",n?r:-r,{characterOptions:i}),f})}function vt(n){return r(function(t,i){var r=!1;return this.changeEachRange(function(t){r=t[n](i)||r}),r})}var wi="undefined",v="character",d="word",u=n.dom,y=n.util,f=y.extend,a=y.createOptions,g=u.getBody,bi=/^[ \t\f\r\n]+$/,ki=/^[ \t\f\r]+$/,yt=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,di=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,nt="en",tt=n.Selection.isDirectionBackward,gi=!1,pt=!1,wt=!1,p,o,bt,ut,ii,ri,et,st,e,vi,lt;(function(){var i=u.createTestElement(document,"<p>1 <\/p><p><\/p>",!0),r=i.firstChild,t=n.getSelection();t.collapse(r.lastChild,2);t.setStart(r.firstChild,0);gi=(""+t).length==1;i.innerHTML="1 <br />";t.collapse(i,2);t.setStart(i.firstChild,0);pt=(""+t).length==1;i.innerHTML="1 <p>1<\/p>";t.collapse(i,2);t.setStart(i.firstChild,0);wt=(""+t).length==1;u.removeNode(i);t.removeAllRanges()})();p={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""};var rr={includeBlockContentTrailingSpace:!1,includeSpaceBeforeBr:!pt,includeSpaceBeforeBlock:!wt,includePreLineTrailingSpace:!0},rt={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:nr}},ur={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},fr={wordOptions:null,characterOptions:null},er={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},or={wordOptions:null,characterOptions:null,direction:"forward"};o=u.getComputedStyleProperty,function(){var n=document.createElement("table"),t=g(document);t.appendChild(n);bt=o(n,"display")=="block";t.removeChild(n)}();ut={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};h.prototype={get:function(n){return this.store.hasOwnProperty(n)?this.store[n]:null},set:function(n,t){return this.store[n]=t}};ii=0;ri=0;et={getPosition:function(n){var t=this.positions;return t.get(n)||t.set(n,new ai(this,n))},toString:function(){return"[NodeWrapper("+u.inspectNode(this.node)+")]"}};ui.prototype=et;var fi="EMPTY",ot="NON_SPACE",ei="UNCOLLAPSIBLE_SPACE",c="COLLAPSIBLE_SPACE",oi="TRAILING_SPACE_BEFORE_BLOCK",si="TRAILING_SPACE_IN_BLOCK",hi="TRAILING_SPACE_BEFORE_BR",ci="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",wr="TRAILING_LINE_BREAK_AFTER_BR",li="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR";f(et,{isCharacterDataNode:i("isCharacterDataNode",u.isCharacterDataNode,"node"),getNodeIndex:i("nodeIndex",u.getNodeIndex,"node"),getLength:i("nodeLength",u.getNodeLength,"node"),containsPositions:i("containsPositions",ar,"node"),isWhitespace:i("isWhitespace",ni,"node"),isCollapsedWhitespace:i("isCollapsedWhitespace",ft,"node"),getComputedDisplay:i("computedDisplay",b,"node"),isCollapsed:i("collapsed",s,"node"),isIgnored:i("ignored",ti,"node"),next:i("nextPos",dt,"node"),previous:i("previous",gt,"node"),getTextNodeInfo:i("textNodeInfo",function(n){var t=null,i=!1,r=o(n.parentNode,"whiteSpace"),u=r=="pre-line";return u?(t=ki,i=!0):(r=="normal"||r=="nowrap")&&(t=bi,i=!0),{node:n,text:n.data,spaceRegex:t,collapseSpaces:i,preLine:u}},"node"),hasInnerText:i("hasInnerText",function(n,t){for(var r=this.session,u=r.getPosition(n.parentNode,this.getNodeIndex()+1),f=r.getPosition(n,0),i=t?u:f,e=t?f:u;i!==e;){if(i.prepopulateChar(),i.isDefinitelyNonEmpty())return!0;i=t?i.previousVisible():i.nextVisible()}return!1},"node"),isRenderedBlock:i("isRenderedBlock",function(n){for(var i=n.getElementsByTagName("br"),t=0,r=i.length;t<r;++t)if(!s(i[t]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:i("trailingSpace",function(n){if(n.tagName.toLowerCase()=="br")return"";switch(this.getComputedDisplay()){case"inline":for(var t=n.lastChild;t;){if(!ti(t))return t.nodeType==1?this.session.getNodeWrapper(t).getTrailingSpace():"";t=t.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"\t";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:i("leadingSpace",function(){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});st={character:"",characterType:fi,isBr:!1,prepopulateChar:function(){var n=this,u,o;if(!n.prepopulatedChar){var f=n.node,t=n.offset,i="",r=fi,e=!1;if(t>0)if(f.nodeType==3){var h=f.data,l=h.charAt(t-1),a=n.nodeWrapper.getTextNodeInfo(),v=a.spaceRegex;a.collapseSpaces?v.test(l)?t>1&&v.test(h.charAt(t-2))||(a.preLine&&h.charAt(t)==="\n"?(i=" ",r=ci):(i=" ",r=c)):(i=l,r=ot,e=!0):(i=l,r=ei,e=!0)}else u=f.childNodes[t-1],u&&u.nodeType==1&&!s(u)&&(u.tagName.toLowerCase()=="br"?(i="\n",n.isBr=!0,r=c,e=!1):n.checkForTrailingSpace=!0),i||(o=f.childNodes[t],o&&o.nodeType==1&&!s(o)&&(n.checkForLeadingSpace=!0));n.prepopulatedChar=!0;n.character=i;n.characterType=r;n.isCharInvariant=e}},isDefinitelyNonEmpty:function(){var n=this.characterType;return n==ot||n==ei},resolveLeadingAndTrailingSpaces:function(){var n,t;this.prepopulatedChar||this.prepopulateChar();this.checkForTrailingSpace&&(n=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace(),n&&(this.isTrailingSpace=!0,this.character=n,this.characterType=c),this.checkForTrailingSpace=!1);this.checkForLeadingSpace&&(t=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace(),t&&(this.isLeadingSpace=!0,this.character=t,this.characterType=c),this.checkForLeadingSpace=!1)},getPrecedingUncollapsedPosition:function(n){for(var t=this,i;t=t.previousVisible();)if(i=t.getCharacter(n),i!=="")return t;return null},getCharacter:function(n){function s(){return h||(i=v.getPrecedingUncollapsedPosition(n),h=!0),i}var e,o;this.resolveLeadingAndTrailingSpaces();var u=this.character,f=ir(n.ignoreCharacters),l=u!==""&&f.indexOf(u)>-1;if(this.isCharInvariant)return l?"":u;if(e=["character",n.includeSpaceBeforeBr,n.includeBlockContentTrailingSpace,n.includePreLineTrailingSpace,f].join("_"),o=this.cache.get(e),o!==null)return o;var r="",a=this.characterType==c,t,i,h=!1,v=this;return a&&(this.type==li?r="\n":u==" "&&(!s()||i.isTrailingSpace||i.character=="\n"||i.character==" "&&i.characterType==c)||(u=="\n"&&this.isLeadingSpace?s()&&i.character!="\n"&&(r="\n"):(t=this.nextUncollapsed(),t&&(t.isBr?this.type=hi:t.isTrailingSpace&&t.character=="\n"?this.type=si:t.isLeadingSpace&&t.character=="\n"&&(this.type=oi),t.character=="\n"?(this.type!=hi||n.includeSpaceBeforeBr)&&(this.type!=oi||n.includeSpaceBeforeBlock)&&(this.type==si&&t.isTrailingSpace&&!n.includeBlockContentTrailingSpace||(this.type!=ci||t.type!=ot||n.includePreLineTrailingSpace)&&(u=="\n"?t.isTrailingSpace?this.isTrailingSpace||this.isBr&&(t.type=wr,s()&&i.isLeadingSpace&&!i.isTrailingSpace&&i.character=="\n"?t.character="":t.type=li):r="\n":u==" "&&(r=" "))):r=u)))),f.indexOf(r)>-1&&(r=""),this.cache.set(e,r),r},equals:function(n){return!!n&&this.node===n.node&&this.offset===n.offset},inspect:br,toString:function(){return this.character}};ai.prototype=st;f(st,{next:i("nextPos",function(n){var u=n.nodeWrapper,i=n.node,f=n.offset,o=u.session,t,r,e;return i?(f==u.getLength()?(t=i.parentNode,r=t?u.getNodeIndex()+1:0):u.isCharacterDataNode()?(t=i,r=f+1):(e=i.childNodes[f],o.getNodeWrapper(e).containsPositions()?(t=e,r=0):(t=i,r=f+1)),t?o.getPosition(t,r):null):null}),previous:i("previous",function(n){var o=n.nodeWrapper,r=n.node,f=n.offset,s=o.session,t,i,e;return f==0?(t=r.parentNode,i=t?o.getNodeIndex():0):o.isCharacterDataNode()?(t=r,i=f-1):(e=r.childNodes[f-1],s.getNodeWrapper(e).containsPositions()?(t=e,i=u.getNodeLength(e)):(t=r,i=f-1)),t?s.getPosition(t,i):null}),nextVisible:i("nextVisible",function(n){var t=n.next();if(!t)return null;var i=t.nodeWrapper,u=t.node,r=t;return i.isCollapsed()&&(r=i.session.getPosition(u.parentNode,i.getNodeIndex()+1)),r}),nextUncollapsed:i("nextUncollapsed",function(n){for(var t=n;t=t.nextVisible();)if(t.resolveLeadingAndTrailingSpaces(),t.character!=="")return t;return null}),previousVisible:i("previousVisible",function(n){var t=n.previous();if(!t)return null;var i=t.nodeWrapper,u=t.node,r=t;return i.isCollapsed()&&(r=i.session.getPosition(u.parentNode,i.getNodeIndex())),r})});e=null;vi=function(){function n(n){var t=new h;return{get:function(i){var u=t.get(i[n]),f,r;if(u)for(f=0;r=u[f++];)if(r.node===i)return r;return null},set:function(i){var r=i.node[n],u=t.get(r)||t.set(r,[]);u.push(i)}}}function t(){this.initCaches()}var i=y.isHostProperty(document.documentElement,"uniqueID");return t.prototype={initCaches:function(){this.elementCache=i?function(){var n=new h;return{get:function(t){return n.get(t.uniqueID)},set:function(t){n.set(t.node.uniqueID,t)}}}():n("tagName");this.textNodeCache=n("data");this.otherNodeCache=n("nodeName")},getNodeWrapper:function(n){var t,i;switch(n.nodeType){case 1:t=this.elementCache;break;case 3:t=this.textNodeCache;break;default:t=this.otherNodeCache}return i=t.get(n),i||(i=new ui(n,this),t.set(i)),i},getPosition:function(n,t){return this.getNodeWrapper(n).getPosition(t)},getRangeBoundaryPosition:function(n,t){var i=t?"start":"end";return this.getPosition(n[i+"Container"],n[i+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},t}();f(u,{nextNode:dt,previousNode:gt});lt=Array.prototype.indexOf?function(n,t){return n.indexOf(t)}:function(n,t){for(var i=0,r=n.length;i<r;++i)if(n[i]===t)return i;return-1};f(n.rangePrototype,{moveStart:at(!0,!1),moveEnd:at(!1,!1),move:at(!0,!0),trimStart:pi(!0),trimEnd:pi(!1),trim:r(function(n,t){var i=this.trimStart(t),r=this.trimEnd(t);return i||r}),expand:r(function(n,t,i){var r=!1,u,a;if(i=w(i,er),u=i.characterOptions,t||(t=v),t==d){var s=i.wordOptions,h=n.getRangeBoundaryPosition(this,!0),c=n.getRangeBoundaryPosition(this,!1),y=k(h,u,s),l=y.nextEndToken(),o=l.chars[0].previousVisible(),e,f;return this.collapsed?e=l:(a=k(c,u,s),e=a.previousStartToken()),f=e.chars[e.chars.length-1],o.equals(h)||(this.setStart(o.node,o.offset),r=!0),f&&!f.equals(c)&&(this.setEnd(f.node,f.offset),r=!0),i.trim&&(i.trimStart&&(r=this.trimStart(u)||r),i.trimEnd&&(r=this.trimEnd(u)||r)),r}return this.moveEnd(v,1,i)}),text:r(function(n,t){return this.collapsed?"":gr(n,this,a(t,p)).join("")}),selectCharacters:r(function(n,t,i,r,u){var f={characterOptions:u};t||(t=g(this.getDocument()));this.selectNodeContents(t);this.collapse(!0);this.moveStart("character",i,f);this.collapse(!0);this.moveEnd("character",r-i,f)}),toCharacterRange:r(function(n,t,i){t||(t=g(this.getDocument()));var e=t.parentNode,o=u.getNodeIndex(t),h=u.comparePoints(this.startContainer,this.endContainer,e,o)==-1,r=this.cloneRange(),f,s;return h?(r.setStartAndEnd(this.startContainer,this.startOffset,e,o),f=-r.text(i).length):(r.setStartAndEnd(e,o,this.startContainer,this.startOffset),f=r.text(i).length),s=f+this.text(i).length,{start:f,end:s}}),findText:r(function(t,i,r){var o,u,s,c,e,l,h,a,f;for(r=w(r,ur),r.wholeWordsOnly&&(r.wordOptions.includeTrailingSpace=!1),o=tt(r.direction),u=r.withinRange,u||(u=n.createRange(),u.selectNodeContents(this.getDocument())),s=i,c=!1,typeof s=="string"?r.caseSensitive||(s=s.toLowerCase()):c=!0,e=t.getRangeBoundaryPosition(this,!o),l=u.comparePoint(e.node,e.offset),l===-1?e=t.getRangeBoundaryPosition(u,!0):l===1&&(e=t.getRangeBoundaryPosition(u,!1)),h=e,a=!1;;)if(f=tu(h,s,c,u,r),f){if(f.valid)return this.setStartAndEnd(f.startPos.node,f.startPos.offset,f.endPos.node,f.endPos.offset),!0;h=o?f.startPos:f.endPos}else if(r.wrap&&!a)u=u.cloneRange(),h=t.getRangeBoundaryPosition(u,!o),u.setBoundary(e.node,e.offset,o),a=!0;else return!1}),pasteHtml:function(n){if(this.deleteContents(),n){var t=this.createContextualFragment(n),i=t.lastChild;this.insertNode(t);this.collapseAfter(i)}}});f(n.selectionPrototype,{expand:r(function(n,t,i){this.changeEachRange(function(n){n.expand(t,i)})}),move:r(function(n,t,i,r){var f=0,u;return this.focusNode&&(this.collapse(this.focusNode,this.focusOffset),u=this.getRangeAt(0),r||(r={}),r.characterOptions=a(r.characterOptions,rr),f=u.move(t,i,r),this.setSingleRange(u)),f}),trimStart:vt("trimStart"),trimEnd:vt("trimEnd"),trim:vt("trim"),selectCharacters:r(function(t,i,r,u,f,e){var o=n.createRange(i);o.selectCharacters(i,r,u,e);this.setSingleRange(o,f)}),saveCharacterRanges:r(function(n,t,i){for(var u=this.getAllRanges(),e=u.length,f=[],o=e==1&&this.isBackward(),r=0,s=u.length;r<s;++r)f[r]={characterRange:u[r].toCharacterRange(t,i),backward:o,characterOptions:i};return f}),restoreCharacterRanges:r(function(t,i,r){this.removeAllRanges();for(var f=0,s=r.length,e,u,o;f<s;++f)u=r[f],o=u.characterRange,e=n.createRange(i),e.selectCharacters(i,o.start,o.end,u.characterOptions),this.addRange(e,u.backward)}),text:r(function(n,t){for(var r=[],i=0,u=this.rangeCount;i<u;++i)r[i]=this.getRangeAt(i).text(t);return r.join("")})});n.innerText=function(t,i){var r=n.createRange(t);return r.selectNodeContents(t),r.text(i)};n.createWordIterator=function(n,t,i){var u=ht();i=w(i,or);var f=u.getPosition(n,t),r=k(f,i.characterOptions,i.wordOptions),e=tt(i.direction);return{next:function(){return e?r.previousStartToken():r.nextEndToken()},dispose:function(){r.dispose();this.next=function(){}}}};n.noMutation=function(n){var t=ht();n(t);ct()};n.noMutation.createEntryPointFunction=r;n.textRange={isBlockNode:cr,isCollapsedWhitespaceNode:ft,createPosition:r(function(n,t,i){return n.getPosition(t,i)})}}),n},this);