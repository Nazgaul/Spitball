(function(n,t){typeof define=="function"&&define.amd?define(["./rangy-core"],n):typeof module!="undefined"&&typeof exports=="object"?module.exports=n(require("rangy")):n(t.rangy)})(function(n){return n.createModule("ClassApplier",["WrappedSelection"],function(n,t){function v(n,t){for(var i in n)if(n.hasOwnProperty(i)&&t(i,n[i])===!1)return!1;return!0}function ut(n){return n.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function ft(n,t){return!!n&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(n)}function y(n,t){if(typeof n.classList=="object")return n.classList.contains(t);var i=typeof n.className=="string",r=i?n.className:n.getAttribute("class");return ft(r,t)}function f(n,t){if(typeof n.classList=="object")n.classList.add(t);else{var r=typeof n.className=="string",i=r?n.className:n.getAttribute("class");i?ft(i,t)||(i+=" "+t):i=t;r?n.className=i:n.setAttribute("class",i)}}function et(n){var t=typeof n.className=="string";return t?n.className:n.getAttribute("class")}function p(n){return n&&n.split(/\s+/).sort().join(" ")}function w(n){return p(et(n))}function ot(n,t){return w(n)==w(t)}function st(n,t){for(var r=t.split(/\s+/),i=0,u=r.length;i<u;++i)if(!y(n,ut(r[i])))return!1;return!0}function dt(n){var t=n.parentNode;return t&&t.nodeType==1&&!/^(textarea|style|script|select|iframe)$/i.test(t.nodeName)}function gt(n,t,i,r,u){var e=n.node,f=n.offset,s=e,o=f;e==r&&f>u&&++o;e==t&&(f==i||f==i+1)&&(s=r,o+=u-i);e==t&&f>i+1&&--o;n.node=s;n.offset=o}function ni(n,t,i){n.node==t&&n.offset>i&&--n.offset}function b(n,t,i,f){i==-1&&(i=t.childNodes.length);var e=n.parentNode,o=r.getNodeIndex(n);u(f,function(n){gt(n,e,o,t,i)});t.childNodes.length==i?t.appendChild(n):t.insertBefore(n,t.childNodes[i])}function ht(n,t){var i=n.parentNode,f=r.getNodeIndex(n);u(t,function(n){ni(n,i,f)});r.removeNode(n)}function ti(n,t,i,r,u){for(var f,e=[];f=n.firstChild;)b(f,t,i++,u),e.push(f);return r&&ht(n,u),e}function k(n,t){return ti(n,n.parentNode,r.getNodeIndex(n),!0,t)}function d(n,t){var r=n.cloneRange(),i,u;return r.selectNodeContents(t),i=r.intersection(n),u=i?i.toString():"",u!=""}function ct(n){for(var t=n.getNodes([3]),u=0,i,r;(i=t[u])&&!d(n,i);)++u;for(r=t.length-1;(i=t[r])&&!d(n,i);)--r;return t.slice(u,r+1)}function lt(n,t){if(n.attributes.length!=t.attributes.length)return!1;for(var u=0,e=n.attributes.length,i,r,f;u<e;++u)if(i=n.attributes[u],f=i.name,f!="class"&&((r=t.attributes.getNamedItem(f),i===null!=(r===null))||i.specified!=r.specified||i.specified&&i.nodeValue!==r.nodeValue))return!1;return!0}function at(n,t){for(var i=0,u=n.attributes.length,r;i<u;++i)if(r=n.attributes[i].name,!(t&&l(t,r))&&n.attributes[i].specified&&r!="class")return!0;return!1}function vt(n){var t;return n&&n.nodeType==1&&((t=n.parentNode)&&t.nodeType==9&&t.designMode=="on"||e(n)&&!e(n.parentNode))}function yt(n){return(e(n)||n.nodeType!=1&&e(n.parentNode))&&!vt(n)}function pt(n){return n&&n.nodeType==1&&!ii.test(h(n,"display"))}function ui(n){if(n.data.length==0)return!0;if(ri.test(n.data))return!1;var t=h(n.parentNode,"whiteSpace");switch(t){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(n.data))return!1}return pt(n.previousSibling)||pt(n.nextSibling)}function g(n){for(var i=[],t,r=0;t=n[r++];)i.push(new rt(t.startContainer,t.startOffset),new rt(t.endContainer,t.endOffset));return i}function nt(n,t){for(var i=0,f,r,u,e=n.length;i<e;++i)f=n[i],r=t[i*2],u=t[i*2+1],f.setStartAndEnd(r.node,r.offset,u.node,u.offset)}function fi(n,t){return r.isCharacterDataNode(n)?t==0?!!n.previousSibling:t==n.length?!!n.nextSibling:!0:t>0&&t<n.childNodes.length}function o(n,i,u,f){var e,s,v=u==0,h,l,a,c;if(r.isAncestorOf(i,n))return n;if(r.isCharacterDataNode(i)){if(h=r.getNodeIndex(i),u==0)u=h;else if(u==i.length)u=h+1;else throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+u+" in "+i.data);i=i.parentNode}if(fi(i,u)){for(e=i.cloneNode(!1),s=i.parentNode,e.id&&e.removeAttribute("id"),a=0;l=i.childNodes[u];)b(l,e,a++,f);return b(e,s,r.getNodeIndex(i)+1,f),i==n?e:o(n,s,r.getNodeIndex(e),f)}return n!=i?(e=i.parentNode,c=r.getNodeIndex(i),v||c++,o(n,e,c,f)):n}function ei(n,t){return n.namespaceURI==t.namespaceURI&&n.tagName.toLowerCase()==t.tagName.toLowerCase()&&ot(n,t)&&lt(n,t)&&h(n,"display")=="inline"&&h(t,"display")=="inline"}function wt(n){var t=n?"nextSibling":"previousSibling";return function(i,r){var e=i.parentNode,u=i[t],f;if(u){if(u&&u.nodeType==3)return u}else if(r&&(u=e[t],u&&u.nodeType==1&&ei(e,u)&&(f=u[n?"firstChild":"lastChild"],f&&f.nodeType==3)))return f;return null}}function tt(n){this.isElementMerge=n.nodeType==1;this.textNodes=[];var t=this.isElementMerge?n.lastChild:n;t&&(this.textNodes[0]=t)}function c(n,t,i){var e,u,c,o,r=this,s,f,l,h;if(r.cssClass=r.className=n,s=null,f={},typeof t=="object"&&t!==null){for(typeof t.elementTagName!="undefined"&&(t.elementTagName=t.elementTagName.toLowerCase()),i=t.tagNames,s=t.elementProperties,f=t.elementAttributes,u=0;o=bt[u++];)t.hasOwnProperty(o)&&(r[o]=t[o]);e=t.normalize}else e=t;if(r.normalize=typeof e=="undefined"?!0:e,r.attrExceptions=[],l=document.createElement(r.elementTagName),r.elementProperties=r.copyPropertiesToElement(s,l,!0),v(f,function(n,t){r.attrExceptions.push(n);f[n]=""+t}),r.elementAttributes=f,r.elementSortedClassName=r.elementProperties.hasOwnProperty("className")?p(r.elementProperties.className+" "+n):n,r.applyToAnyTagName=!1,h=typeof i,h=="string")i=="*"?r.applyToAnyTagName=!0:r.tagNames=ut(i.toLowerCase()).split(/\s*,\s*/);else if(h=="object"&&typeof i.length=="number")for(r.tagNames=[],u=0,c=i.length;u<c;++u)i[u]=="*"?r.applyToAnyTagName=!0:r.tagNames.push(i[u].toLowerCase());else r.tagNames=[r.elementTagName]}function hi(n,t,i){return new c(n,t,i)}var r=n.dom,rt=r.DomPosition,l=r.arrayContains,a=n.util,u=a.forEach,kt=a.isHostMethod(document,"createElementNS"),s=function(){function n(n,t,i){return t&&i?" ":""}return function(t,i){if(typeof t.classList=="object")t.classList.remove(i);else{var u=typeof t.className=="string",r=u?t.className:t.getAttribute("class");r=r.replace(new RegExp("(^|\\s)"+i+"(\\s|$)"),n);u?t.className=r:t.setAttribute("class",r)}}}(),h=r.getComputedStyleProperty,e=function(){var n=document.createElement("div");return typeof n.isContentEditable=="boolean"?function(n){return n&&n.nodeType==1&&n.isContentEditable}:function(n){return!n||n.nodeType!=1||n.contentEditable=="false"?!1:n.contentEditable=="true"||e(n.parentNode)}}(),ii=/^inline(-block|-table)?$/i,ri=/[^\r\n\t\f \u200B]/,oi=wt(!1),si=wt(!0),bt,it;tt.prototype={doMerge:function(n){var f=this.textNodes,t=f[0];if(f.length>1){var o=r.getNodeIndex(t),s=[],e=0,i;u(f,function(f,h){i=f.parentNode;h>0&&(i.removeChild(f),i.hasChildNodes()||r.removeNode(i),n&&u(n,function(n){n.node==f&&(n.node=t,n.offset+=e);n.node==i&&n.offset>o&&(--n.offset,n.offset==o+1&&h<len-1&&(n.node=t,n.offset=e))}));s[h]=f.data;e+=f.data.length});t.data=s.join("")}return t.data},getLength:function(){for(var n=this.textNodes.length,t=0;n--;)t+=this.textNodes[n].length;return t},toString:function(){var n=[];return u(this.textNodes,function(t,i){n[i]="'"+t.data+"'"}),"[Merge("+n.join(",")+")]"}};bt=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"];it={};c.prototype={elementTagName:"span",elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(n,t,i){var u,s,o={},h,e,c,l;for(var r in n)if(n.hasOwnProperty(r))if(e=n[r],c=t[r],r=="className")f(t,e),f(t,this.className),t[r]=p(t[r]),i&&(o[r]=e);else if(r=="style"){s=c;i&&(o[r]=h={});for(u in n[r])n[r].hasOwnProperty(u)&&(s[u]=e[u],i&&(h[u]=s[u]));this.attrExceptions.push(r)}else t[r]=e,i&&(o[r]=t[r],l=it.hasOwnProperty(r)?it[r]:r,this.attrExceptions.push(l));return i?o:""},copyAttributesToElement:function(n,t){for(var i in n)n.hasOwnProperty(i)&&!/^class(?:Name)?$/i.test(i)&&t.setAttribute(i,n[i])},appliesToElement:function(n){return l(this.tagNames,n.tagName.toLowerCase())},getEmptyElements:function(n){var t=this;return n.getNodes([1],function(n){return t.appliesToElement(n)&&!n.hasChildNodes()})},hasClass:function(n){return n.nodeType==1&&(this.applyToAnyTagName||this.appliesToElement(n))&&y(n,this.className)},getSelfOrAncestorWithClass:function(n){while(n){if(this.hasClass(n))return n;n=n.parentNode}return null},isModifiable:function(n){return!this.applyToEditableOnly||yt(n)},isIgnorableWhiteSpaceNode:function(n){return this.ignoreWhiteSpace&&n&&n.nodeType==3&&ui(n)},postApply:function(n,t,r,f){var a=n[0],o=n[n.length-1],s=[],e,h=a,v=o,y=0,p=o.length,c,l;if(u(n,function(n){c=oi(n,!f);c?(e||(e=new tt(c),s.push(e)),e.textNodes.push(n),n===a&&(h=e.textNodes[0],y=h.length),n===o&&(v=e.textNodes[0],p=e.getLength())):e=null}),l=si(o,!f),l&&(e||(e=new tt(o),s.push(e)),e.textNodes.push(l)),s.length){for(i=0,len=s.length;i<len;++i)s[i].doMerge(r);t.setStartAndEnd(h,y,v,p)}},createContainer:function(n){var i=r.getDocument(n),u,t=kt&&!r.isHtmlNamespace(n)&&(u=n.namespaceURI)?i.createElementNS(n.namespaceURI,this.elementTagName):i.createElement(this.elementTagName);if(this.copyPropertiesToElement(this.elementProperties,t,!1),this.copyAttributesToElement(this.elementAttributes,t),f(t,this.className),this.onElementCreate)this.onElementCreate(t,this);return t},elementHasProperties:function(n,t){var i=this;return v(t,function(t,r){if(t=="className")return st(n,r);if(typeof r=="object"){if(!i.elementHasProperties(n[t],r))return!1}else if(n[t]!==r)return!1})},elementHasAttributes:function(n,t){return v(t,function(t,i){if(n.getAttribute(t)!==i)return!1})},applyToTextNode:function(n){var t,i,r;dt(n)&&(t=n.parentNode,t.childNodes.length==1&&this.useExistingElements&&this.appliesToElement(t)&&this.elementHasProperties(t,this.elementProperties)&&this.elementHasAttributes(t,this.elementAttributes)?f(t,this.className):(i=n.parentNode,r=this.createContainer(i),i.insertBefore(r,n),r.appendChild(n)))},isRemovable:function(n){return n.tagName.toLowerCase()==this.elementTagName&&w(n)==this.elementSortedClassName&&this.elementHasProperties(n,this.elementProperties)&&!at(n,this.attrExceptions)&&this.elementHasAttributes(n,this.elementAttributes)&&this.isModifiable(n)},isEmptyContainer:function(n){var t=n.childNodes.length;return n.nodeType==1&&this.isRemovable(n)&&(t==0||t==1&&this.isEmptyContainer(n.firstChild))},removeEmptyContainers:function(n){var r=this,f=n.getNodes([1],function(n){return r.isEmptyContainer(n)}),t=[n],i=g(t);u(f,function(n){ht(n,i)});nt(t,i)},undoToTextNode:function(n,t,i,r){if(!t.containsNode(i)){var u=t.cloneRange();u.selectNode(i);u.isPointInRange(t.endContainer,t.endOffset)&&(o(i,t.endContainer,t.endOffset,r),t.setEndAfter(i));u.isPointInRange(t.startContainer,t.startOffset)&&(i=o(i,t.startContainer,t.startOffset,r))}this.isRemovable(i)?k(i,r):s(i,this.className)},splitAncestorWithClass:function(n,t,i){var r=this.getSelfOrAncestorWithClass(n);r&&o(r,n,t,i)},undoToAncestor:function(n,t){this.isRemovable(n)?k(n,t):s(n,this.className)},applyToRange:function(n,t){var i=this,e,r,o,s;t=t||[];e=g(t||[]);n.splitBoundariesPreservingPositions(e);i.removeEmptyElements&&i.removeEmptyContainers(n);r=ct(n);r.length&&(u(r,function(n){i.isIgnorableWhiteSpaceNode(n)||i.getSelfOrAncestorWithClass(n)||!i.isModifiable(n)||i.applyToTextNode(n,e)}),o=r[r.length-1],n.setStartAndEnd(r[0],0,o,o.length),i.normalize&&i.postApply(r,n,e,!1),nt(t,e));s=i.getEmptyElements(n);u(s,function(n){f(n,i.className)})},applyToRanges:function(n){for(var t=n.length;t--;)this.applyToRange(n[t],n);return n},applyToSelection:function(t){var i=n.getSelection(t);i.setRanges(this.applyToRanges(i.getAllRanges()))},undoToRange:function(n,t){var i=this,r,f,o,h,c,e,l,a;if(t=t||[],r=g(t),n.splitBoundariesPreservingPositions(r),i.removeEmptyElements&&i.removeEmptyContainers(n,r),f=ct(n),c=f[f.length-1],f.length){for(i.splitAncestorWithClass(n.endContainer,n.endOffset,r),i.splitAncestorWithClass(n.startContainer,n.startOffset,r),e=0,l=f.length;e<l;++e)o=f[e],h=i.getSelfOrAncestorWithClass(o),h&&i.isModifiable(o)&&i.undoToAncestor(h,r);n.setStartAndEnd(f[0],0,c,c.length);i.normalize&&i.postApply(f,n,r,!0);nt(t,r)}a=i.getEmptyElements(n);u(a,function(n){s(n,i.className)})},undoToRanges:function(n){for(var t=n.length;t--;)this.undoToRange(n[t],n);return n},undoToSelection:function(t){var r=n.getSelection(t),i=n.getSelection(t).getAllRanges();this.undoToRanges(i);r.setRanges(i)},isAppliedToRange:function(n){var i,r,t;if(n.collapsed||n.toString()=="")return!!this.getSelfOrAncestorWithClass(n.commonAncestorContainer);if(i=n.getNodes([3]),i.length)for(r=0;t=i[r++];)if(!this.isIgnorableWhiteSpaceNode(t)&&d(n,t)&&this.isModifiable(t)&&!this.getSelfOrAncestorWithClass(t))return!1;return!0},isAppliedToRanges:function(n){var t=n.length;if(t==0)return!1;while(t--)if(!this.isAppliedToRange(n[t]))return!1;return!0},isAppliedToSelection:function(t){var i=n.getSelection(t);return this.isAppliedToRanges(i.getAllRanges())},toggleRange:function(n){this.isAppliedToRange(n)?this.undoToRange(n):this.applyToRange(n)},toggleSelection:function(n){this.isAppliedToSelection(n)?this.undoToSelection(n):this.applyToSelection(n)},getElementsWithClassIntersectingRange:function(n){var t=[],i=this;return n.getNodes([3],function(n){var r=i.getSelfOrAncestorWithClass(n);r&&!l(t,r)&&t.push(r)}),t},detach:function(){}};c.util={hasClass:y,addClass:f,removeClass:s,getClass:et,hasSameClasses:ot,hasAllClasses:st,replaceWithOwnChildren:k,elementsHaveSameNonClassAttributes:lt,elementHasNonClassAttributes:at,splitNodeAt:o,isEditableElement:e,isEditingHost:vt,isEditable:yt};n.CssClassApplier=n.ClassApplier=c;n.createClassApplier=hi;a.createAliasForDeprecatedMethod(n,"createCssClassApplier","createClassApplier",t)}),n},this);