(function(n,t){typeof define=="function"&&define.amd?define(["./rangy-core"],n):typeof module!="undefined"&&typeof exports=="object"?module.exports=n(require("rangy")):n(t.rangy)})(function(n){return n.createModule("Serializer",["WrappedSelection"],function(n,t){function a(n){return n.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function f(n,t){var r;t=t||[];var e=n.nodeType,o=n.childNodes,s=o.length,h=[e,n.nodeName,s].join(":"),i="",u="";switch(e){case 3:i=a(n.nodeValue);break;case 8:i="<!--"+a(n.nodeValue)+"-->";break;default:i="<"+h+">";u="<\/>"}for(i&&t.push(i),r=0;r<s;++r)f(o[r],t);return u&&t.push(u),t}function r(n){var t=f(n).join("");return u(t).toString(16)}function e(n,t,r){var f=[],u=n;for(r=r||i.getDocument(n).documentElement;u&&u!=r;)f.push(i.getNodeIndex(u,!0)),u=u.parentNode;return f.join("/")+":"+t}function o(n,r,u){r||(r=(u||document).documentElement);for(var o=n.split(":"),f=r,h=o[0]?o[0].split("/"):[],s=h.length,e;s--;)if(e=parseInt(h[s],10),e<f.childNodes.length)f=f.childNodes[e];else throw t.createError("deserializePosition() failed: node "+i.inspectNode(f)+" has no child with index "+e+", "+s);return new i.DomPosition(f,parseInt(o[1],10))}function v(u,f,o){if(o=o||n.DomRange.getRangeDocument(u).documentElement,!i.isOrIsAncestorOf(o,u.commonAncestorContainer))throw t.createError("serializeRange(): range "+u.inspect()+" is not wholly contained within specified root node "+i.inspectNode(o));var s=e(u.startContainer,u.startOffset,o)+","+e(u.endContainer,u.endOffset,o);return f||(s+="{"+r(o)+"}"),s}function y(u,f,e){var h,c,l;if(f?e=e||i.getDocument(f):(e=e||document,f=e.documentElement),h=s.exec(u),c=h[4],c&&(l=r(f),c!==l))throw t.createError("deserializeRange(): checksums of serialized range root node ("+c+") and target root node ("+l+") do not match");var a=o(h[1],f,e),v=o(h[2],f,e),y=n.createRange(e);return y.setStartAndEnd(a.node,a.offset,v.node,v.offset),y}function p(n,t,i){t||(t=(i||document).documentElement);var f=s.exec(n),u=f[3];return!u||u===r(t)}function w(t,i,r){var f,e,u,o;for(t=n.getSelection(t),f=t.getAllRanges(),e=[],u=0,o=f.length;u<o;++u)e[u]=v(f[u],i,r);return e.join("|")}function b(t,r,u){var f,h;r?u=u||i.getWindow(r):(u=u||window,r=u.document.documentElement);var e=t.split("|"),o=n.getSelection(u),s=[];for(f=0,h=e.length;f<h;++f)s[f]=y(e[f],r,u.document);return o.setRanges(s),o}function k(n,t,r){var e,f,u,o;for(t?e=r?r.document:i.getDocument(t):(r=r||window,t=r.document.documentElement),f=n.split("|"),u=0,o=f.length;u<o;++u)if(!p(f[u],t,e))return!1;return!0}function d(n){for(var u=n.split(/[;,]/),t=0,f=u.length,i,r;t<f;++t)if(i=u[t].split("="),i[0].replace(/^\s+/,"")==h&&(r=i[1],r))return decodeURIComponent(r.replace(/\s+$/,""));return null}function g(n){n=n||window;var t=d(n.document.cookie);t&&b(t,n.doc)}function nt(t,i){t=t||window;i=typeof i=="object"?i:{};var r=i.expires?";expires="+i.expires.toUTCString():"",u=i.path?";path="+i.path:"",f=i.domain?";domain="+i.domain:"",e=i.secure?";secure":"",o=w(n.getSelection(t));t.document.cookie=encodeURIComponent(h)+"="+encodeURIComponent(o)+r+u+f+e}var c="undefined",l=n.util,u,i,s,h;(typeof encodeURIComponent==c||typeof decodeURIComponent==c)&&t.fail("encodeURIComponent and/or decodeURIComponent method is missing");u=function(){function t(n){for(var i=[],r=0,u=n.length,t;r<u;++r)t=n.charCodeAt(r),t<128?i.push(t):t<2048?i.push(t>>6|192,t&63|128):i.push(t>>12|224,t>>6&63|128,t&63|128);return i}function i(){for(var i=[],t=0,r,n;t<256;++t){for(n=t,r=8;r--;)(n&1)==1?n=n>>>1^3988292384:n>>>=1;i[t]=n>>>0}return i}function r(){return n||(n=i()),n}var n=null;return function(n){for(var f=t(n),i=-1,o=r(),u=0,s=f.length,e;u<s;++u)e=(i^f[u])&255,i=i>>>8^o[e];return(i^-1)>>>0}}();i=n.dom;s=/^([^,]+),([^,\{]+)(\{([^}]+)\})?$/;h="rangySerializedSelection";l.extend(n,{serializePosition:e,deserializePosition:o,serializeRange:v,deserializeRange:y,canDeserializeRange:p,serializeSelection:w,deserializeSelection:b,canDeserializeSelection:k,restoreSelectionFromCookie:g,saveSelectionCookie:nt,getElementChecksum:r,nodeToInfoString:f});l.crc32=u}),n},this);