@using Zbang.Cloudents.Mobile.Views.Box.Resources
@using Zbang.Cloudents.Mobile.Views.Shared.Resources

<aside class="QA" ng-controller="QnACtrl">

    @*<button type="button" ng-click="showAllQuestion()" ng-if="info.state === 3" class="back">@SharedResources.Back</button>*@

    <form class="clearfix QForm" name="qnaQform" ng-submit="postQuestion(qnaQform.$valid)" ng-if="info.state > 1 && !info.selectedQuestion" novalidate ng-init="showPost=false">
        <div class="textareaWpr">
            <img ng-src="{{info.userImage}}" class="QAImg lFloat" alt="" width="32" height="32" />
            <textarea text-direction msd-elastic name="content" class="QTextarea" ng-placeholder="@IndexResources.OnYourMind" required ng-model="qFormData.content" ng-focus="checkAuth() && (showPost=true)"></textarea>
            <ul class="attachedList">
                <li class="attachedItem" ng-repeat="file in qFormData.files">
                    <span class="attachName elps">{{file.name}}</span>
                    <button class="removeAttach" ng-click="removeQuestionAttachment(file)"></button>
                </li>
            </ul>
        </div>
        <div class="rFloat">
            <button type="button" ng-show="showPost" class="attachBtn" ng-disabled="!qnaQform.$valid" ng-click="addQuestionAttachment()"></button>
            <button type="submit" ng-show="showPost"  class="askBtn" ng-disabled="!qnaQform.$valid">@SharedResources.Post</button>
        </div>
    </form>


    <div class="QWpr">
        <div class="questions">
            <ul class="QList">
                <li class="QItem" ng-repeat="question in info.questions">
                    <div class="QTop clearfix " ng-click="showAllAnswers(question)" ng-class="{hasAttached: question.files.length}">
                        <span class="tag" ng-if="question.isNew">@SharedResources.New</span>
                        <div class="lFloat QTopLeft">
                            <img class="QAImg" alt="" width="32" height="32" ng-src="{{question.userImage}}" user-tooltip-popup="{{question.userId}}"/> @*//uid*@
                            <div class="attachBtn"></div>
                            <div class="numAttached">{{question.files.length}}</div>
                        </div>
                        <div class="userName boldFont elps">{{question.userName}}</div><span class="createTime" display-time="{{question.createTime}}"></span>
                        <div class="QContent" ng-bind-html="question.content"></div>
                    </div>
                    <div class="postAnswer" ng-form="qnaAform" novalidate ng-if="!question.answers.length" ng-init="showComment=false">
                        <div class="arrow upArrow"></div>
                        <img class="QAImg lFloat" ng-src="{{info.userImage}}" alt="" width="32" height="32" />
                        <div class="textareaWpr">
                            <textarea text-direction msd-elastic required name="content" class="QTextarea" ng-placeholder="@SharedResources.WriteComment" ng-model="question.aFormData.content" ng-focus="checkAuth() && (showComment=true)"></textarea>
                            <ul class="attachedList">
                                <li class="attachedItem" ng-repeat="file in question.aFormData.files">
                                    <span class="attachName elps">{{file.name}}</span>
                                    <button class="removeAttach" ng-click="removeAnswerAttachment(question,file)"></button>
                                </li>
                            </ul>
                        </div>
                        <div class="rFloat" ng-show="showComment">
                            <button type="button" class="attachBtn" ng-disabled="!qnaAform.$valid" ng-click="addAnswerAttachment(question)"></button>
                            <button type="submit" class="askBtn" ng-click="postAnswer(question)" ng-disabled="!qnaAform.$valid">@SharedResources.Comment</button>
                        </div>
                    </div>
                    <div class="QBottom clearfix">
                        <div class="arrow upArrow" ng-if="question.answers.length"></div>
                        <div class="answerBottom" ng-click="showAllAnswers(question)" ng-if="question.answers.length">
                            <button type="button" class="numAnswers" ng-bind="answersLength(question)"></button>
                            <button type="button">@SharedResources.AddComment</button>
                        </div>

                        <span ng-if="question.bestAnswer">
                            <img class="QAImg lFloat" ng-src="{{question.bestAnswer.userImage}}" alt="" width="32" height="32" user-tooltip-popup="{{question.bestAnswer.userId}}" />
                            <div class="AUsername semiFont elps">{{question.bestAnswer.userName}}</div><span class="createTime" display-time="{{question.bestAnswer.createTime}}"></span>
                            <div class="AContent" ng-bind-html="question.bestAnswer.content"></div>
                            <ul class="qaAttach">
                                <li class="qaAttachItem" ng-repeat="file in question.bestAnswer.files">
                                    <a ng-href="{{file.itemUrl}}"><img ng-src="{{file.thumbnail}}" alt="" width="100" height="125" /></a>
                                    <div class="attachActions">
                                        <a class="attachFull" ng-href="{{file.itemUrl}}"></a>
                                        <button class="attachDelete" type="button" ng-if="file.isVisible" ng-click="removeAttachment(question.bestAnswer,file)"></button>
                                        <a class="attachDownload" target="_blank" ng-href="{{file.download}}"></a>
                                    </div>
                                </li>
                            </ul>
                        </span>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <div class="AWpr" m-custom-scrollbar top="299" ng-animate="'animate'" ng-if="info.state === 3">
        <div id="Answers" class="answers" ng-if="info.selectedQuestion">
            <div class="question">
                <img class="QAImg lFloat" ng-src="{{info.selectedQuestion.userImage}}" alt="" width="32" height="32" user-tooltip-popup="{{info.selectedQuestion.userUid}}"/>
                <div class="questionRhs">
                    <div class="userName boldFont elps">{{info.selectedQuestion.userName}}</div><span class="createTime innerSection" display-time="{{info.selectedQuestion.createTime}}"></span>
                    <div class="QContent" ng-bind-html="info.selectedQuestion.content"></div>
                </div>
                <button type="button" class="deleteBtn" ng-click="deleteQuestion(info.selectedQuestion)" ng-if="canDelete(info.selectedQuestion)"></button>
            </div>
            <div class="lFloat" ng-class="{attachLeft : info.selectedQuestion.files.length}">
                <div class="attachBtn"></div>
                <div class="numAttached">info.selectedQuestion.files.length</div>
            </div>
            <ul class="qaAttach">
                <li class="qaAttachItem" ng-repeat="file in info.selectedQuestion.files">
                    <a ng-href="{{file.itemUrl}}"><img ng-src="{{file.thumbnail}}" alt="" width="100" height="125" /></a>
                    <div class="attachActions">
                        <a tooltip="@IndexResources.ShowAttachment" ng-href="{{file.itemUrl}}" class="attachFull"></a>
                        <button tooltip="@IndexResources.RemoveAttachment" class="attachDelete" type="button" ng-if="file.isVisible" ng-click="removeAttachment(info.selectedQuestion,file)"></button>
                        <a tooltip-placement="top" tooltip="@IndexResources.DownloadAttachment" class="attachDownload" target="_blank" ng-href="{{file.download}}"></a>
                    </div>
                </li>
            </ul>
            <ul class="AList">
                <li class="AItem" ng-repeat="answer in info.selectedQuestion.answers" ng-class="{best : answer.isAnswer}">
                    @*Temporarily Removed vote btn... DO NOT DELETE!*@
                    @*<div class="bestAnswer splitHR"><span class="splitHRText">@IndexResources.BestAnswer</span></div>*@
                    <img class="QAImg lFloat" user-tooltip-popup="{{question.userId}}" ng-src="{{answer.userImage}}" alt="" width="32" height="32" />
                    <div class="userName boldFont elps">{{answer.userName}}</div><span class="createTime innerSection" display-time="{{answer.createTime}}"></span>
                    @*Temporarily Removed vote btn... DO NOT DELETE!*@
                    @*<button title="@IndexResources.Useful" class="voteBtn rFloat" type="button" data-bind="click:$root.rateAnswer"></button>
                        <span class="aScore rFloat" data-bind="text:rating"></span>*@
                    <button type="button" class="deleteBtn rFloat" ng-click="deleteAnswer(info.selectedQuestion,answer)" ng-if="canDelete(answer)"></button>
                    <div class="AContent" ng-bind-html="answer.content"></div>
                    @*Temporarily Removed vote btn... DO NOT DELETE!*@
                    @*<button title="@IndexResources.MarkCorrect" type="button" class="markAnswerBtn" data-bind="click: $root.markAnswer, visible: $parent.canMarkAsAnswer"></button>*@
                    <ul class="qaAttach">
                        <li class="qaAttachItem" ng-repeat="file in answer.files">
                            <a ng-href="{{file.itemUrl}}"><img ng-src="{{file.thumbnail}}" alt="" width="100" height="125" /></a>
                            <div class="attachActions">
                                <a class="attachFull" ng-href="{{file.itemUrl}}"></a>
                                <button class="attachDelete" type="button" ng-if="file.isVisible" ng-click="removeAttachment(answer,file)"></button>
                                <a class="attachDownload" target="_blank" ng-href="{{item.download}}"></a>
                            </div>
                        </li>
                    </ul>
                </li>
            </ul>
            <div class="enterAnswer clearfix">
                <div ng-form="qnaAform" class="clearfix" novalidate ng-init="showComment=false">
                    <img class="QAImg lFloat" ng-src="{{info.userImage}}" alt="" width="32" height="32" />
                    <div class="textareaWpr">
                        <textarea text-direction msd-elastic name="content" required class="QTextarea" ng-placeholder="@SharedResources.WriteComment" ng-model="info.selectedQuestion.aFormData.content" ng-focus="checkAuth() && (showComment=true)"></textarea>
                        <ul class="attachedList">
                            <li class="attachedItem" ng-repeat="file in info.selectedQuestion.aFormData.files">
                                <span class="attachName elps">{{file.name}}</span>
                                <button class="removeAttach" ng-click="removeAnswerAttachment(info.selectedQuestion,file)"></button>
                            </li>
                        </ul>
                    </div>
                    <div class="rFloat">
                        <button type="button" class="attachBtn" ng-show="showComment" ng-click="addAnswerAttachment(info.selectedQuestion)"></button>
                        <button type="submit" class="askBtn" ng-click="postAnswer(info.selectedQuestion)" ng-disabled="!qnaAform.$valid" ng-show="showComment">@SharedResources.Comment</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="QAContent" ng-if="info.state === 1">
        <div class="QEmpty">
            <div class="qaText1">@IndexResources.NotClear</div>
            <form class="clearfix QEmptyForm" name="qnaQform" novalidate ng-init="showComment=false">
                <div class="textareaWpr">
                    <img ng-src="{{info.userImage}}" class="QAImg lFloat" alt="" width="32" height="32" />
                    <textarea text-direction msd-elastic name="content" class="QTextarea" ng-placeholder="@IndexResources.OnYourMind" required ng-model="qFormData.content" ng-focus="checkAuth() && (showComment=true)"></textarea>
                    <ul class="attachedList">
                        <li class="attachedItem" ng-repeat="file in qFormData.files">
                            <span class="attachName elps">{{file.name}}</span>
                            <button class="removeAttach" ng-click="removeQuestionAttachment(file)"></button>
                        </li>
                    </ul>
                </div>
                <div class="rFloat" ng-show="showComment">
                    <button type="button" class="attachBtn" ng-disabled="!qnaQform.$valid" ng-click="addQuestionAttachment()"></button>
                    <button type="submit" class="askBtn" ng-click="postQuestion(qnaQform.$valid)">@SharedResources.Comment</button>
                </div>
            </form>
            <div class="qaText2">@IndexResources.NoQuestions</div>
        </div>
    </div>



</aside>
