<?xml version="1.0" encoding="utf-8" ?>

<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
                   assembly="Zbang.Zbox.Domain"
                   namespace="Zbang.Zbox.Domain">
  <class name="Item" table="Item" >
    <id name="Id" type="long" column="ItemId">
      <generator class="native"/>
    </id>
    <discriminator column="Discriminator" not-null="true" type="System.String" />
    <property name="Name" length="4000"/>
    <property name="IsDeleted" index="iBoxIsDeleted"/>
    <many-to-one name="Uploader" class="User" column="UserId" not-null="true"/>
    <property name="Size"/>
    <property name="NumberOfViews"/>
    <property name="NumberOfComments"/>
    <component name="DateTimeUser" class="UserTimeDetails">
      <property name="CreationTime" insert="true" update="false">
        <column name="CreationTime" not-null="true" sql-type="datetime2(2)"/>
      </property>
      <property name="UpdateTime"  insert="true">
        <column name="UpdateTime" not-null="true" sql-type="datetime2(2)" />
      </property>
      <property name="CreatedUser"  not-null="true" insert="true" update="false"/>
      <property name="UpdatedUser"  not-null="true" insert="true" />
    </component>
    <many-to-one column="BoxId" class="Box" name="Box" index="iBoxIsDeleted"/>


    <many-to-one column="QuestionId" class="Comment" name="Comment" />
    <many-to-one column="AnswerId" class="CommentReplies" name="Answer"/>

    <property name="ItemContentUrl" column="BlobName"/>

    <property name="Rate" >
      <column name="Rate" sql-type="float"/>
    </property>
    <property name="ThumbnailBlobName"/>
    <property name="ThumbnailUrl"/>
    <property name="Url" length="4000"/>

    <bag name="ItemRates"  cascade="all-delete-orphan" inverse="true" lazy="true">
      <key column="ItemId"/>
      <one-to-many class="ItemRate"/>
    </bag>
    <bag name="Updates" inverse="true" lazy="true" cascade="delete-orphan" >
      <key column="ItemId" foreign-key="NewUpdatesItem"/>
      <one-to-many class="Updates"/>
    </bag>
    
    <bag name="ItemComments" inverse="true" lazy="true" cascade="delete-orphan" >
      <key column="ItemId" foreign-key="itemIdItemComment"/>
      <one-to-many class="ItemComment"/>
    </bag>
    <bag name="ItemReplies" inverse="true" lazy="true" cascade="delete-orphan" >
      <key column="ItemId" foreign-key="itemIdItemReply"/>
      <one-to-many class="ItemCommentReply"/>
    </bag>
    
    <subclass name="Link" discriminator-value="Link">
      <property name="Sponsored"/>
    </subclass>
    <subclass name="File" discriminator-value="File">
      
      <property name="NumberOfDownloads"/>
      <property name="Content" type="string" length="500" />
    </subclass>
  </class>
</hibernate-mapping>