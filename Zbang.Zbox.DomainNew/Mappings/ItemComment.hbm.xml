<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
                   assembly="Zbang.Zbox.Domain"
                   namespace="Zbang.Zbox.Domain">
  <class name="ItemComment" table="ItemComment">
    <id name="Id" column="ItemCommentId">
      <generator class="assigned"></generator>
    </id>
    
    <many-to-one name="Item" class="Item" column="ItemId" not-null="true" foreign-key="itemIdItemComment"/>
    <property name="Comment" not-null="true" length="8000"></property>
    <component name="UserTime" class="UserTimeDetails">
      <property name="CreationTime" not-null="true" insert="true" update="false" />
      <property name="UpdateTime"  not-null="true" insert="true"  />
      <property name="CreatedUser"  not-null="true" insert="true" update="false"/>
      <property name="UpdatedUser"  not-null="true" insert="true" />
    </component>
    <bag name="Replies"  cascade="all-delete-orphan" inverse="true" lazy="true">
      <key column="ParentId"/>
      <one-to-many class="ItemCommentReply"/>
    </bag>
    <many-to-one name="Author" class="User" column="UserId" not-null="true" foreign-key="userIdItemComment"/>
    
    <bag name="Updates" inverse="true" lazy="true" cascade="delete-orphan" >
      <key column="ItemCommentId" foreign-key="NewUpdatesItemComment"/>
      <one-to-many class="Updates"/>
    </bag>
  </class>
  
  
  <class name="ItemCommentReply" table="ItemCommentReply">
    <id name="Id" column="ItemReplyId">
      <generator class="assigned"></generator>
    </id>
    <many-to-one name="Item" class="Item" column="ItemId" not-null="true" foreign-key="itemIdItemReply"/>
    <many-to-one name="Author" class="User" column="UserId" not-null="true" foreign-key="userIdItemReply"/>
    <many-to-one name="Parent" class="ItemComment" column="ParentId" not-null="true" foreign-key="parentIdItemReply"/>
    <component name="UserTime" class="UserTimeDetails">
      <property name="CreationTime" not-null="true" insert="true" update="false" />
      <property name="UpdateTime"  not-null="true" insert="true"  />
      <property name="CreatedUser"  not-null="true" insert="true" update="false"/>
      <property name="UpdatedUser"  not-null="true" insert="true" />
    </component>
    <property name="Comment" not-null="true" length="8000"></property>
    <bag name="Updates" inverse="true" lazy="true" cascade="delete-orphan" >
      <key column="ItemCommentReplyId" foreign-key="NewUpdatesItemCommentReply"/>
      <one-to-many class="Updates"/>
    </bag>
  </class>

</hibernate-mapping>
